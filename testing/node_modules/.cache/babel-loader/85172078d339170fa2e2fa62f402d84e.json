{"ast":null,"code":"/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\n(function (global, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof module !== 'undefined' && module.exports) {\n    // CommonJS. Define export.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    global.tv4 = factory();\n  }\n})(this, function () {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\n  if (!Object.keys) {\n    Object.keys = function () {\n      var hasOwnProperty = Object.prototype.hasOwnProperty,\n          hasDontEnumBug = !{\n        toString: null\n      }.propertyIsEnumerable('toString'),\n          dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n          dontEnumsLength = dontEnums.length;\n      return function (obj) {\n        if (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n          throw new TypeError('Object.keys called on non-object');\n        }\n\n        var result = [];\n\n        for (var prop in obj) {\n          if (hasOwnProperty.call(obj, prop)) {\n            result.push(prop);\n          }\n        }\n\n        if (hasDontEnumBug) {\n          for (var i = 0; i < dontEnumsLength; i++) {\n            if (hasOwnProperty.call(obj, dontEnums[i])) {\n              result.push(dontEnums[i]);\n            }\n          }\n        }\n\n        return result;\n      };\n    }();\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\n\n\n  if (!Object.create) {\n    Object.create = function () {\n      function F() {}\n\n      return function (o) {\n        if (arguments.length !== 1) {\n          throw new Error('Object.create implementation only accepts one parameter.');\n        }\n\n        F.prototype = o;\n        return new F();\n      };\n    }();\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\n\n\n  if (!Array.isArray) {\n    Array.isArray = function (vArg) {\n      return Object.prototype.toString.call(vArg) === \"[object Array]\";\n    };\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\n\n\n  if (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function (searchElement\n    /*, fromIndex */\n    ) {\n      if (this === null) {\n        throw new TypeError();\n      }\n\n      var t = Object(this);\n      var len = t.length >>> 0;\n\n      if (len === 0) {\n        return -1;\n      }\n\n      var n = 0;\n\n      if (arguments.length > 1) {\n        n = Number(arguments[1]);\n\n        if (n !== n) {\n          // shortcut for verifying if it's NaN\n          n = 0;\n        } else if (n !== 0 && n !== Infinity && n !== -Infinity) {\n          n = (n > 0 || -1) * Math.floor(Math.abs(n));\n        }\n      }\n\n      if (n >= len) {\n        return -1;\n      }\n\n      var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n\n      for (; k < len; k++) {\n        if (k in t && t[k] === searchElement) {\n          return k;\n        }\n      }\n\n      return -1;\n    };\n  } // Grungey Object.isFrozen hack\n\n\n  if (!Object.isFrozen) {\n    Object.isFrozen = function (obj) {\n      var key = \"tv4_test_frozen_key\";\n\n      while (obj.hasOwnProperty(key)) {\n        key += Math.random();\n      }\n\n      try {\n        obj[key] = true;\n        delete obj[key];\n        return false;\n      } catch (e) {\n        return true;\n      }\n    };\n  } // Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\n\n\n  var uriTemplateGlobalModifiers = {\n    \"+\": true,\n    \"#\": true,\n    \".\": true,\n    \"/\": true,\n    \";\": true,\n    \"?\": true,\n    \"&\": true\n  };\n  var uriTemplateSuffices = {\n    \"*\": true\n  };\n\n  function notReallyPercentEncode(string) {\n    return encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\n      return \"%\" + doubleEncoded.substring(3);\n    });\n  }\n\n  function uriTemplateSubstitution(spec) {\n    var modifier = \"\";\n\n    if (uriTemplateGlobalModifiers[spec.charAt(0)]) {\n      modifier = spec.charAt(0);\n      spec = spec.substring(1);\n    }\n\n    var separator = \"\";\n    var prefix = \"\";\n    var shouldEscape = true;\n    var showVariables = false;\n    var trimEmptyString = false;\n\n    if (modifier === '+') {\n      shouldEscape = false;\n    } else if (modifier === \".\") {\n      prefix = \".\";\n      separator = \".\";\n    } else if (modifier === \"/\") {\n      prefix = \"/\";\n      separator = \"/\";\n    } else if (modifier === '#') {\n      prefix = \"#\";\n      shouldEscape = false;\n    } else if (modifier === ';') {\n      prefix = \";\";\n      separator = \";\";\n      showVariables = true;\n      trimEmptyString = true;\n    } else if (modifier === '?') {\n      prefix = \"?\";\n      separator = \"&\";\n      showVariables = true;\n    } else if (modifier === '&') {\n      prefix = \"&\";\n      separator = \"&\";\n      showVariables = true;\n    }\n\n    var varNames = [];\n    var varList = spec.split(\",\");\n    var varSpecs = [];\n    var varSpecMap = {};\n\n    for (var i = 0; i < varList.length; i++) {\n      var varName = varList[i];\n      var truncate = null;\n\n      if (varName.indexOf(\":\") !== -1) {\n        var parts = varName.split(\":\");\n        varName = parts[0];\n        truncate = parseInt(parts[1], 10);\n      }\n\n      var suffices = {};\n\n      while (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\n        suffices[varName.charAt(varName.length - 1)] = true;\n        varName = varName.substring(0, varName.length - 1);\n      }\n\n      var varSpec = {\n        truncate: truncate,\n        name: varName,\n        suffices: suffices\n      };\n      varSpecs.push(varSpec);\n      varSpecMap[varName] = varSpec;\n      varNames.push(varName);\n    }\n\n    var subFunction = function (valueFunction) {\n      var result = \"\";\n      var startIndex = 0;\n\n      for (var i = 0; i < varSpecs.length; i++) {\n        var varSpec = varSpecs[i];\n        var value = valueFunction(varSpec.name);\n\n        if (value === null || value === undefined || Array.isArray(value) && value.length === 0 || typeof value === 'object' && Object.keys(value).length === 0) {\n          startIndex++;\n          continue;\n        }\n\n        if (i === startIndex) {\n          result += prefix;\n        } else {\n          result += separator || \",\";\n        }\n\n        if (Array.isArray(value)) {\n          if (showVariables) {\n            result += varSpec.name + \"=\";\n          }\n\n          for (var j = 0; j < value.length; j++) {\n            if (j > 0) {\n              result += varSpec.suffices['*'] ? separator || \",\" : \",\";\n\n              if (varSpec.suffices['*'] && showVariables) {\n                result += varSpec.name + \"=\";\n              }\n            }\n\n            result += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\n          }\n        } else if (typeof value === \"object\") {\n          if (showVariables && !varSpec.suffices['*']) {\n            result += varSpec.name + \"=\";\n          }\n\n          var first = true;\n\n          for (var key in value) {\n            if (!first) {\n              result += varSpec.suffices['*'] ? separator || \",\" : \",\";\n            }\n\n            first = false;\n            result += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\n            result += varSpec.suffices['*'] ? '=' : \",\";\n            result += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\n          }\n        } else {\n          if (showVariables) {\n            result += varSpec.name;\n\n            if (!trimEmptyString || value !== \"\") {\n              result += \"=\";\n            }\n          }\n\n          if (varSpec.truncate != null) {\n            value = value.substring(0, varSpec.truncate);\n          }\n\n          result += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\") : notReallyPercentEncode(value);\n        }\n      }\n\n      return result;\n    };\n\n    subFunction.varNames = varNames;\n    return {\n      prefix: prefix,\n      substitution: subFunction\n    };\n  }\n\n  function UriTemplate(template) {\n    if (!(this instanceof UriTemplate)) {\n      return new UriTemplate(template);\n    }\n\n    var parts = template.split(\"{\");\n    var textParts = [parts.shift()];\n    var prefixes = [];\n    var substitutions = [];\n    var varNames = [];\n\n    while (parts.length > 0) {\n      var part = parts.shift();\n      var spec = part.split(\"}\")[0];\n      var remainder = part.substring(spec.length + 1);\n      var funcs = uriTemplateSubstitution(spec);\n      substitutions.push(funcs.substitution);\n      prefixes.push(funcs.prefix);\n      textParts.push(remainder);\n      varNames = varNames.concat(funcs.substitution.varNames);\n    }\n\n    this.fill = function (valueFunction) {\n      var result = textParts[0];\n\n      for (var i = 0; i < substitutions.length; i++) {\n        var substitution = substitutions[i];\n        result += substitution(valueFunction);\n        result += textParts[i + 1];\n      }\n\n      return result;\n    };\n\n    this.varNames = varNames;\n    this.template = template;\n  }\n\n  UriTemplate.prototype = {\n    toString: function () {\n      return this.template;\n    },\n    fillFromObject: function (obj) {\n      return this.fill(function (varName) {\n        return obj[varName];\n      });\n    }\n  };\n\n  var ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\n    this.missing = [];\n    this.missingMap = {};\n    this.formatValidators = parent ? Object.create(parent.formatValidators) : {};\n    this.schemas = parent ? Object.create(parent.schemas) : {};\n    this.collectMultiple = collectMultiple;\n    this.errors = [];\n    this.handleError = collectMultiple ? this.collectError : this.returnError;\n\n    if (checkRecursive) {\n      this.checkRecursive = true;\n      this.scanned = [];\n      this.scannedFrozen = [];\n      this.scannedFrozenSchemas = [];\n      this.scannedFrozenValidationErrors = [];\n      this.validatedSchemasKey = 'tv4_validation_id';\n      this.validationErrorsKey = 'tv4_validation_errors_id';\n    }\n\n    if (trackUnknownProperties) {\n      this.trackUnknownProperties = true;\n      this.knownPropertyPaths = {};\n      this.unknownPropertyPaths = {};\n    }\n\n    this.errorReporter = errorReporter || defaultErrorReporter('en');\n\n    if (typeof this.errorReporter === 'string') {\n      throw new Error('debug');\n    }\n\n    this.definedKeywords = {};\n\n    if (parent) {\n      for (var key in parent.definedKeywords) {\n        this.definedKeywords[key] = parent.definedKeywords[key].slice(0);\n      }\n    }\n  };\n\n  ValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\n    this.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\n    this.definedKeywords[keyword].push(keywordFunction);\n  };\n\n  ValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\n    var error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\n    error.message = this.errorReporter(error, data, schema);\n    return error;\n  };\n\n  ValidatorContext.prototype.returnError = function (error) {\n    return error;\n  };\n\n  ValidatorContext.prototype.collectError = function (error) {\n    if (error) {\n      this.errors.push(error);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\n    for (var i = startIndex; i < this.errors.length; i++) {\n      this.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\n    }\n\n    return this;\n  };\n\n  ValidatorContext.prototype.banUnknownProperties = function (data, schema) {\n    for (var unknownPath in this.unknownPropertyPaths) {\n      var error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {\n        path: unknownPath\n      }, unknownPath, \"\", null, data, schema);\n      var result = this.handleError(error);\n\n      if (result) {\n        return result;\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.addFormat = function (format, validator) {\n    if (typeof format === 'object') {\n      for (var key in format) {\n        this.addFormat(key, format[key]);\n      }\n\n      return this;\n    }\n\n    this.formatValidators[format] = validator;\n  };\n\n  ValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\n    if (schema['$ref'] !== undefined) {\n      urlHistory = urlHistory || {};\n\n      if (urlHistory[schema['$ref']]) {\n        return this.createError(ErrorCodes.CIRCULAR_REFERENCE, {\n          urls: Object.keys(urlHistory).join(', ')\n        }, '', '', null, undefined, schema);\n      }\n\n      urlHistory[schema['$ref']] = true;\n      schema = this.getSchema(schema['$ref'], urlHistory);\n    }\n\n    return schema;\n  };\n\n  ValidatorContext.prototype.getSchema = function (url, urlHistory) {\n    var schema;\n\n    if (this.schemas[url] !== undefined) {\n      schema = this.schemas[url];\n      return this.resolveRefs(schema, urlHistory);\n    }\n\n    var baseUrl = url;\n    var fragment = \"\";\n\n    if (url.indexOf('#') !== -1) {\n      fragment = url.substring(url.indexOf(\"#\") + 1);\n      baseUrl = url.substring(0, url.indexOf(\"#\"));\n    }\n\n    if (typeof this.schemas[baseUrl] === 'object') {\n      schema = this.schemas[baseUrl];\n      var pointerPath = decodeURIComponent(fragment);\n\n      if (pointerPath === \"\") {\n        return this.resolveRefs(schema, urlHistory);\n      } else if (pointerPath.charAt(0) !== \"/\") {\n        return undefined;\n      }\n\n      var parts = pointerPath.split(\"/\").slice(1);\n\n      for (var i = 0; i < parts.length; i++) {\n        var component = parts[i].replace(/~1/g, \"/\").replace(/~0/g, \"~\");\n\n        if (schema[component] === undefined) {\n          schema = undefined;\n          break;\n        }\n\n        schema = schema[component];\n      }\n\n      if (schema !== undefined) {\n        return this.resolveRefs(schema, urlHistory);\n      }\n    }\n\n    if (this.missing[baseUrl] === undefined) {\n      this.missing.push(baseUrl);\n      this.missing[baseUrl] = baseUrl;\n      this.missingMap[baseUrl] = baseUrl;\n    }\n  };\n\n  ValidatorContext.prototype.searchSchemas = function (schema, url) {\n    if (Array.isArray(schema)) {\n      for (var i = 0; i < schema.length; i++) {\n        this.searchSchemas(schema[i], url);\n      }\n    } else if (schema && typeof schema === \"object\") {\n      if (typeof schema.id === \"string\") {\n        if (isTrustedUrl(url, schema.id)) {\n          if (this.schemas[schema.id] === undefined) {\n            this.schemas[schema.id] = schema;\n          }\n        }\n      }\n\n      for (var key in schema) {\n        if (key !== \"enum\") {\n          if (typeof schema[key] === \"object\") {\n            this.searchSchemas(schema[key], url);\n          } else if (key === \"$ref\") {\n            var uri = getDocumentUri(schema[key]);\n\n            if (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\n              this.missingMap[uri] = uri;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  ValidatorContext.prototype.addSchema = function (url, schema) {\n    //overload\n    if (typeof url !== 'string' || typeof schema === 'undefined') {\n      if (typeof url === 'object' && typeof url.id === 'string') {\n        schema = url;\n        url = schema.id;\n      } else {\n        return;\n      }\n    }\n\n    if (url === getDocumentUri(url) + \"#\") {\n      // Remove empty fragment\n      url = getDocumentUri(url);\n    }\n\n    this.schemas[url] = schema;\n    delete this.missingMap[url];\n    normSchema(schema, url);\n    this.searchSchemas(schema, url);\n  };\n\n  ValidatorContext.prototype.getSchemaMap = function () {\n    var map = {};\n\n    for (var key in this.schemas) {\n      map[key] = this.schemas[key];\n    }\n\n    return map;\n  };\n\n  ValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\n    var list = [];\n\n    for (var key in this.schemas) {\n      if (!filterRegExp || filterRegExp.test(key)) {\n        list.push(key);\n      }\n    }\n\n    return list;\n  };\n\n  ValidatorContext.prototype.getMissingUris = function (filterRegExp) {\n    var list = [];\n\n    for (var key in this.missingMap) {\n      if (!filterRegExp || filterRegExp.test(key)) {\n        list.push(key);\n      }\n    }\n\n    return list;\n  };\n\n  ValidatorContext.prototype.dropSchemas = function () {\n    this.schemas = {};\n    this.reset();\n  };\n\n  ValidatorContext.prototype.reset = function () {\n    this.missing = [];\n    this.missingMap = {};\n    this.errors = [];\n  };\n\n  ValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\n    var topLevel;\n    schema = this.resolveRefs(schema);\n\n    if (!schema) {\n      return null;\n    } else if (schema instanceof ValidationError) {\n      this.errors.push(schema);\n      return schema;\n    }\n\n    var startErrorCount = this.errors.length;\n    var frozenIndex,\n        scannedFrozenSchemaIndex = null,\n        scannedSchemasIndex = null;\n\n    if (this.checkRecursive && data && typeof data === 'object') {\n      topLevel = !this.scanned.length;\n\n      if (data[this.validatedSchemasKey]) {\n        var schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\n\n        if (schemaIndex !== -1) {\n          this.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\n          return null;\n        }\n      }\n\n      if (Object.isFrozen(data)) {\n        frozenIndex = this.scannedFrozen.indexOf(data);\n\n        if (frozenIndex !== -1) {\n          var frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\n\n          if (frozenSchemaIndex !== -1) {\n            this.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\n            return null;\n          }\n        }\n      }\n\n      this.scanned.push(data);\n\n      if (Object.isFrozen(data)) {\n        if (frozenIndex === -1) {\n          frozenIndex = this.scannedFrozen.length;\n          this.scannedFrozen.push(data);\n          this.scannedFrozenSchemas.push([]);\n        }\n\n        scannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\n        this.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\n        this.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\n      } else {\n        if (!data[this.validatedSchemasKey]) {\n          try {\n            Object.defineProperty(data, this.validatedSchemasKey, {\n              value: [],\n              configurable: true\n            });\n            Object.defineProperty(data, this.validationErrorsKey, {\n              value: [],\n              configurable: true\n            });\n          } catch (e) {\n            //IE 7/8 workaround\n            data[this.validatedSchemasKey] = [];\n            data[this.validationErrorsKey] = [];\n          }\n        }\n\n        scannedSchemasIndex = data[this.validatedSchemasKey].length;\n        data[this.validatedSchemasKey][scannedSchemasIndex] = schema;\n        data[this.validationErrorsKey][scannedSchemasIndex] = [];\n      }\n    }\n\n    var errorCount = this.errors.length;\n    var error = this.validateBasic(data, schema, dataPointerPath) || this.validateNumeric(data, schema, dataPointerPath) || this.validateString(data, schema, dataPointerPath) || this.validateArray(data, schema, dataPointerPath) || this.validateObject(data, schema, dataPointerPath) || this.validateCombinations(data, schema, dataPointerPath) || this.validateHypermedia(data, schema, dataPointerPath) || this.validateFormat(data, schema, dataPointerPath) || this.validateDefinedKeywords(data, schema, dataPointerPath) || null;\n\n    if (topLevel) {\n      while (this.scanned.length) {\n        var item = this.scanned.pop();\n        delete item[this.validatedSchemasKey];\n      }\n\n      this.scannedFrozen = [];\n      this.scannedFrozenSchemas = [];\n    }\n\n    if (error || errorCount !== this.errors.length) {\n      while (dataPathParts && dataPathParts.length || schemaPathParts && schemaPathParts.length) {\n        var dataPart = dataPathParts && dataPathParts.length ? \"\" + dataPathParts.pop() : null;\n        var schemaPart = schemaPathParts && schemaPathParts.length ? \"\" + schemaPathParts.pop() : null;\n\n        if (error) {\n          error = error.prefixWith(dataPart, schemaPart);\n        }\n\n        this.prefixErrors(errorCount, dataPart, schemaPart);\n      }\n    }\n\n    if (scannedFrozenSchemaIndex !== null) {\n      this.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\n    } else if (scannedSchemasIndex !== null) {\n      data[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\n    }\n\n    return this.handleError(error);\n  };\n\n  ValidatorContext.prototype.validateFormat = function (data, schema) {\n    if (typeof schema.format !== 'string' || !this.formatValidators[schema.format]) {\n      return null;\n    }\n\n    var errorMessage = this.formatValidators[schema.format].call(null, data, schema);\n\n    if (typeof errorMessage === 'string' || typeof errorMessage === 'number') {\n      return this.createError(ErrorCodes.FORMAT_CUSTOM, {\n        message: errorMessage\n      }, '', '/format', null, data, schema);\n    } else if (errorMessage && typeof errorMessage === 'object') {\n      return this.createError(ErrorCodes.FORMAT_CUSTOM, {\n        message: errorMessage.message || \"?\"\n      }, errorMessage.dataPath || '', errorMessage.schemaPath || \"/format\", null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\n    for (var key in this.definedKeywords) {\n      if (typeof schema[key] === 'undefined') {\n        continue;\n      }\n\n      var validationFunctions = this.definedKeywords[key];\n\n      for (var i = 0; i < validationFunctions.length; i++) {\n        var func = validationFunctions[i];\n        var result = func(data, schema[key], schema, dataPointerPath);\n\n        if (typeof result === 'string' || typeof result === 'number') {\n          return this.createError(ErrorCodes.KEYWORD_CUSTOM, {\n            key: key,\n            message: result\n          }, '', '', null, data, schema).prefixWith(null, key);\n        } else if (result && typeof result === 'object') {\n          var code = result.code;\n\n          if (typeof code === 'string') {\n            if (!ErrorCodes[code]) {\n              throw new Error('Undefined error code (use defineError): ' + code);\n            }\n\n            code = ErrorCodes[code];\n          } else if (typeof code !== 'number') {\n            code = ErrorCodes.KEYWORD_CUSTOM;\n          }\n\n          var messageParams = typeof result.message === 'object' ? result.message : {\n            key: key,\n            message: result.message || \"?\"\n          };\n          var schemaPath = result.schemaPath || \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\n          return this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\n        }\n      }\n    }\n\n    return null;\n  };\n\n  function recursiveCompare(A, B) {\n    if (A === B) {\n      return true;\n    }\n\n    if (A && B && typeof A === \"object\" && typeof B === \"object\") {\n      if (Array.isArray(A) !== Array.isArray(B)) {\n        return false;\n      } else if (Array.isArray(A)) {\n        if (A.length !== B.length) {\n          return false;\n        }\n\n        for (var i = 0; i < A.length; i++) {\n          if (!recursiveCompare(A[i], B[i])) {\n            return false;\n          }\n        }\n      } else {\n        var key;\n\n        for (key in A) {\n          if (B[key] === undefined && A[key] !== undefined) {\n            return false;\n          }\n        }\n\n        for (key in B) {\n          if (A[key] === undefined && B[key] !== undefined) {\n            return false;\n          }\n        }\n\n        for (key in A) {\n          if (!recursiveCompare(A[key], B[key])) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  ValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\n    var error;\n\n    if (error = this.validateType(data, schema, dataPointerPath)) {\n      return error.prefixWith(null, \"type\");\n    }\n\n    if (error = this.validateEnum(data, schema, dataPointerPath)) {\n      return error.prefixWith(null, \"type\");\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateType = function validateType(data, schema) {\n    if (schema.type === undefined) {\n      return null;\n    }\n\n    var dataType = typeof data;\n\n    if (data === null) {\n      dataType = \"null\";\n    } else if (Array.isArray(data)) {\n      dataType = \"array\";\n    }\n\n    var allowedTypes = schema.type;\n\n    if (!Array.isArray(allowedTypes)) {\n      allowedTypes = [allowedTypes];\n    }\n\n    for (var i = 0; i < allowedTypes.length; i++) {\n      var type = allowedTypes[i];\n\n      if (type === dataType || type === \"integer\" && dataType === \"number\" && data % 1 === 0) {\n        return null;\n      }\n    }\n\n    return this.createError(ErrorCodes.INVALID_TYPE, {\n      type: dataType,\n      expected: allowedTypes.join(\"/\")\n    }, '', '', null, data, schema);\n  };\n\n  ValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\n    if (schema[\"enum\"] === undefined) {\n      return null;\n    }\n\n    for (var i = 0; i < schema[\"enum\"].length; i++) {\n      var enumVal = schema[\"enum\"][i];\n\n      if (recursiveCompare(data, enumVal)) {\n        return null;\n      }\n    }\n\n    return this.createError(ErrorCodes.ENUM_MISMATCH, {\n      value: typeof JSON !== 'undefined' ? JSON.stringify(data) : data\n    }, '', '', null, data, schema);\n  };\n\n  ValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\n    return this.validateMultipleOf(data, schema, dataPointerPath) || this.validateMinMax(data, schema, dataPointerPath) || this.validateNaN(data, schema, dataPointerPath) || null;\n  };\n\n  var CLOSE_ENOUGH_LOW = Math.pow(2, -51);\n  var CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\n\n  ValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\n    var multipleOf = schema.multipleOf || schema.divisibleBy;\n\n    if (multipleOf === undefined) {\n      return null;\n    }\n\n    if (typeof data === \"number\") {\n      var remainder = data / multipleOf % 1;\n\n      if (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\n        return this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {\n          value: data,\n          multipleOf: multipleOf\n        }, '', '', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\n    if (typeof data !== \"number\") {\n      return null;\n    }\n\n    if (schema.minimum !== undefined) {\n      if (data < schema.minimum) {\n        return this.createError(ErrorCodes.NUMBER_MINIMUM, {\n          value: data,\n          minimum: schema.minimum\n        }, '', '/minimum', null, data, schema);\n      }\n\n      if (schema.exclusiveMinimum && data === schema.minimum) {\n        return this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {\n          value: data,\n          minimum: schema.minimum\n        }, '', '/exclusiveMinimum', null, data, schema);\n      }\n    }\n\n    if (schema.maximum !== undefined) {\n      if (data > schema.maximum) {\n        return this.createError(ErrorCodes.NUMBER_MAXIMUM, {\n          value: data,\n          maximum: schema.maximum\n        }, '', '/maximum', null, data, schema);\n      }\n\n      if (schema.exclusiveMaximum && data === schema.maximum) {\n        return this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {\n          value: data,\n          maximum: schema.maximum\n        }, '', '/exclusiveMaximum', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\n    if (typeof data !== \"number\") {\n      return null;\n    }\n\n    if (isNaN(data) === true || data === Infinity || data === -Infinity) {\n      return this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {\n        value: data\n      }, '', '/type', null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\n    return this.validateStringLength(data, schema, dataPointerPath) || this.validateStringPattern(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\n    if (typeof data !== \"string\") {\n      return null;\n    }\n\n    if (schema.minLength !== undefined) {\n      if (data.length < schema.minLength) {\n        return this.createError(ErrorCodes.STRING_LENGTH_SHORT, {\n          length: data.length,\n          minimum: schema.minLength\n        }, '', '/minLength', null, data, schema);\n      }\n    }\n\n    if (schema.maxLength !== undefined) {\n      if (data.length > schema.maxLength) {\n        return this.createError(ErrorCodes.STRING_LENGTH_LONG, {\n          length: data.length,\n          maximum: schema.maxLength\n        }, '', '/maxLength', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\n    if (typeof data !== \"string\" || typeof schema.pattern !== \"string\" && !(schema.pattern instanceof RegExp)) {\n      return null;\n    }\n\n    var regexp;\n\n    if (schema.pattern instanceof RegExp) {\n      regexp = schema.pattern;\n    } else {\n      var body,\n          flags = ''; // Check for regular expression literals\n      // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\n\n      var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\n\n      if (literal) {\n        body = literal[1];\n        flags = literal[2];\n      } else {\n        body = schema.pattern;\n      }\n\n      regexp = new RegExp(body, flags);\n    }\n\n    if (!regexp.test(data)) {\n      return this.createError(ErrorCodes.STRING_PATTERN, {\n        pattern: schema.pattern\n      }, '', '/pattern', null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\n    if (!Array.isArray(data)) {\n      return null;\n    }\n\n    return this.validateArrayLength(data, schema, dataPointerPath) || this.validateArrayUniqueItems(data, schema, dataPointerPath) || this.validateArrayItems(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\n    var error;\n\n    if (schema.minItems !== undefined) {\n      if (data.length < schema.minItems) {\n        error = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {\n          length: data.length,\n          minimum: schema.minItems\n        }, '', '/minItems', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    if (schema.maxItems !== undefined) {\n      if (data.length > schema.maxItems) {\n        error = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {\n          length: data.length,\n          maximum: schema.maxItems\n        }, '', '/maxItems', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\n    if (schema.uniqueItems) {\n      for (var i = 0; i < data.length; i++) {\n        for (var j = i + 1; j < data.length; j++) {\n          if (recursiveCompare(data[i], data[j])) {\n            var error = this.createError(ErrorCodes.ARRAY_UNIQUE, {\n              match1: i,\n              match2: j\n            }, '', '/uniqueItems', null, data, schema);\n\n            if (this.handleError(error)) {\n              return error;\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\n    if (schema.items === undefined) {\n      return null;\n    }\n\n    var error, i;\n\n    if (Array.isArray(schema.items)) {\n      for (i = 0; i < data.length; i++) {\n        if (i < schema.items.length) {\n          if (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i], dataPointerPath + \"/\" + i)) {\n            return error;\n          }\n        } else if (schema.additionalItems !== undefined) {\n          if (typeof schema.additionalItems === \"boolean\") {\n            if (!schema.additionalItems) {\n              error = this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, '/' + i, '/additionalItems', null, data, schema);\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"], dataPointerPath + \"/\" + i)) {\n            return error;\n          }\n        }\n      }\n    } else {\n      for (i = 0; i < data.length; i++) {\n        if (error = this.validateAll(data[i], schema.items, [i], [\"items\"], dataPointerPath + \"/\" + i)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\n    if (typeof data !== \"object\" || data === null || Array.isArray(data)) {\n      return null;\n    }\n\n    return this.validateObjectMinMaxProperties(data, schema, dataPointerPath) || this.validateObjectRequiredProperties(data, schema, dataPointerPath) || this.validateObjectProperties(data, schema, dataPointerPath) || this.validateObjectDependencies(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\n    var keys = Object.keys(data);\n    var error;\n\n    if (schema.minProperties !== undefined) {\n      if (keys.length < schema.minProperties) {\n        error = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {\n          propertyCount: keys.length,\n          minimum: schema.minProperties\n        }, '', '/minProperties', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    if (schema.maxProperties !== undefined) {\n      if (keys.length > schema.maxProperties) {\n        error = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {\n          propertyCount: keys.length,\n          maximum: schema.maxProperties\n        }, '', '/maxProperties', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\n    if (schema.required !== undefined) {\n      for (var i = 0; i < schema.required.length; i++) {\n        var key = schema.required[i];\n\n        if (data[key] === undefined) {\n          var error = this.createError(ErrorCodes.OBJECT_REQUIRED, {\n            key: key\n          }, '', '/required/' + i, null, data, schema);\n\n          if (this.handleError(error)) {\n            return error;\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\n    var error;\n\n    for (var key in data) {\n      var keyPointerPath = dataPointerPath + \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\n      var foundMatch = false;\n\n      if (schema.properties !== undefined && schema.properties[key] !== undefined) {\n        foundMatch = true;\n\n        if (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key], keyPointerPath)) {\n          return error;\n        }\n      }\n\n      if (schema.patternProperties !== undefined) {\n        for (var patternKey in schema.patternProperties) {\n          var regexp = new RegExp(patternKey);\n\n          if (regexp.test(key)) {\n            foundMatch = true;\n\n            if (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey], keyPointerPath)) {\n              return error;\n            }\n          }\n        }\n      }\n\n      if (!foundMatch) {\n        if (schema.additionalProperties !== undefined) {\n          if (this.trackUnknownProperties) {\n            this.knownPropertyPaths[keyPointerPath] = true;\n            delete this.unknownPropertyPaths[keyPointerPath];\n          }\n\n          if (typeof schema.additionalProperties === \"boolean\") {\n            if (!schema.additionalProperties) {\n              error = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {\n                key: key\n              }, '', '/additionalProperties', null, data, schema).prefixWith(key, null);\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else {\n            if (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"], keyPointerPath)) {\n              return error;\n            }\n          }\n        } else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\n          this.unknownPropertyPaths[keyPointerPath] = true;\n        }\n      } else if (this.trackUnknownProperties) {\n        this.knownPropertyPaths[keyPointerPath] = true;\n        delete this.unknownPropertyPaths[keyPointerPath];\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\n    var error;\n\n    if (schema.dependencies !== undefined) {\n      for (var depKey in schema.dependencies) {\n        if (data[depKey] !== undefined) {\n          var dep = schema.dependencies[depKey];\n\n          if (typeof dep === \"string\") {\n            if (data[dep] === undefined) {\n              error = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {\n                key: depKey,\n                missing: dep\n              }, '', '', null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else if (Array.isArray(dep)) {\n            for (var i = 0; i < dep.length; i++) {\n              var requiredKey = dep[i];\n\n              if (data[requiredKey] === undefined) {\n                error = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {\n                  key: depKey,\n                  missing: requiredKey\n                }, '', '/' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\n\n                if (this.handleError(error)) {\n                  return error;\n                }\n              }\n            }\n          } else {\n            if (error = this.validateAll(data, dep, [], [\"dependencies\", depKey], dataPointerPath)) {\n              return error;\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\n    return this.validateAllOf(data, schema, dataPointerPath) || this.validateAnyOf(data, schema, dataPointerPath) || this.validateOneOf(data, schema, dataPointerPath) || this.validateNot(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\n    if (schema.allOf === undefined) {\n      return null;\n    }\n\n    var error;\n\n    for (var i = 0; i < schema.allOf.length; i++) {\n      var subSchema = schema.allOf[i];\n\n      if (error = this.validateAll(data, subSchema, [], [\"allOf\", i], dataPointerPath)) {\n        return error;\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\n    if (schema.anyOf === undefined) {\n      return null;\n    }\n\n    var errors = [];\n    var startErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n    }\n\n    var errorAtEnd = true;\n\n    for (var i = 0; i < schema.anyOf.length; i++) {\n      if (this.trackUnknownProperties) {\n        this.unknownPropertyPaths = {};\n        this.knownPropertyPaths = {};\n      }\n\n      var subSchema = schema.anyOf[i];\n      var errorCount = this.errors.length;\n      var error = this.validateAll(data, subSchema, [], [\"anyOf\", i], dataPointerPath);\n\n      if (error === null && errorCount === this.errors.length) {\n        this.errors = this.errors.slice(0, startErrorCount);\n\n        if (this.trackUnknownProperties) {\n          for (var knownKey in this.knownPropertyPaths) {\n            oldKnownPropertyPaths[knownKey] = true;\n            delete oldUnknownPropertyPaths[knownKey];\n          }\n\n          for (var unknownKey in this.unknownPropertyPaths) {\n            if (!oldKnownPropertyPaths[unknownKey]) {\n              oldUnknownPropertyPaths[unknownKey] = true;\n            }\n          } // We need to continue looping so we catch all the property definitions, but we don't want to return an error\n\n\n          errorAtEnd = false;\n          continue;\n        }\n\n        return null;\n      }\n\n      if (error) {\n        errors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\n      }\n    }\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (errorAtEnd) {\n      errors = errors.concat(this.errors.slice(startErrorCount));\n      this.errors = this.errors.slice(0, startErrorCount);\n      return this.createError(ErrorCodes.ANY_OF_MISSING, {}, \"\", \"/anyOf\", errors, data, schema);\n    }\n  };\n\n  ValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\n    if (schema.oneOf === undefined) {\n      return null;\n    }\n\n    var validIndex = null;\n    var errors = [];\n    var startErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n    }\n\n    for (var i = 0; i < schema.oneOf.length; i++) {\n      if (this.trackUnknownProperties) {\n        this.unknownPropertyPaths = {};\n        this.knownPropertyPaths = {};\n      }\n\n      var subSchema = schema.oneOf[i];\n      var errorCount = this.errors.length;\n      var error = this.validateAll(data, subSchema, [], [\"oneOf\", i], dataPointerPath);\n\n      if (error === null && errorCount === this.errors.length) {\n        if (validIndex === null) {\n          validIndex = i;\n        } else {\n          this.errors = this.errors.slice(0, startErrorCount);\n          return this.createError(ErrorCodes.ONE_OF_MULTIPLE, {\n            index1: validIndex,\n            index2: i\n          }, \"\", \"/oneOf\", null, data, schema);\n        }\n\n        if (this.trackUnknownProperties) {\n          for (var knownKey in this.knownPropertyPaths) {\n            oldKnownPropertyPaths[knownKey] = true;\n            delete oldUnknownPropertyPaths[knownKey];\n          }\n\n          for (var unknownKey in this.unknownPropertyPaths) {\n            if (!oldKnownPropertyPaths[unknownKey]) {\n              oldUnknownPropertyPaths[unknownKey] = true;\n            }\n          }\n        }\n      } else if (error) {\n        errors.push(error);\n      }\n    }\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (validIndex === null) {\n      errors = errors.concat(this.errors.slice(startErrorCount));\n      this.errors = this.errors.slice(0, startErrorCount);\n      return this.createError(ErrorCodes.ONE_OF_MISSING, {}, \"\", \"/oneOf\", errors, data, schema);\n    } else {\n      this.errors = this.errors.slice(0, startErrorCount);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\n    if (schema.not === undefined) {\n      return null;\n    }\n\n    var oldErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n      this.unknownPropertyPaths = {};\n      this.knownPropertyPaths = {};\n    }\n\n    var error = this.validateAll(data, schema.not, null, null, dataPointerPath);\n    var notErrors = this.errors.slice(oldErrorCount);\n    this.errors = this.errors.slice(0, oldErrorCount);\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (error === null && notErrors.length === 0) {\n      return this.createError(ErrorCodes.NOT_PASSED, {}, \"\", \"/not\", null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\n    if (!schema.links) {\n      return null;\n    }\n\n    var error;\n\n    for (var i = 0; i < schema.links.length; i++) {\n      var ldo = schema.links[i];\n\n      if (ldo.rel === \"describedby\") {\n        var template = new UriTemplate(ldo.href);\n        var allPresent = true;\n\n        for (var j = 0; j < template.varNames.length; j++) {\n          if (!(template.varNames[j] in data)) {\n            allPresent = false;\n            break;\n          }\n        }\n\n        if (allPresent) {\n          var schemaUrl = template.fillFromObject(data);\n          var subSchema = {\n            \"$ref\": schemaUrl\n          };\n\n          if (error = this.validateAll(data, subSchema, [], [\"links\", i], dataPointerPath)) {\n            return error;\n          }\n        }\n      }\n    }\n  }; // parseURI() and resolveUrl() are from https://gist.github.com/1088850\n  //   -  released as public domain by author (\"Yaffle\") - see comments on gist\n\n\n  function parseURI(url) {\n    var m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/); // authority = '//' + user + ':' + pass '@' + hostname + ':' port\n\n    return m ? {\n      href: m[0] || '',\n      protocol: m[1] || '',\n      authority: m[2] || '',\n      host: m[3] || '',\n      hostname: m[4] || '',\n      port: m[5] || '',\n      pathname: m[6] || '',\n      search: m[7] || '',\n      hash: m[8] || ''\n    } : null;\n  }\n\n  function resolveUrl(base, href) {\n    // RFC 3986\n    function removeDotSegments(input) {\n      var output = [];\n      input.replace(/^(\\.\\.?(\\/|$))+/, '').replace(/\\/(\\.(\\/|$))+/g, '/').replace(/\\/\\.\\.$/, '/../').replace(/\\/?[^\\/]*/g, function (p) {\n        if (p === '/..') {\n          output.pop();\n        } else {\n          output.push(p);\n        }\n      });\n      return output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\n    }\n\n    href = parseURI(href || '');\n    base = parseURI(base || '');\n    return !href || !base ? null : (href.protocol || base.protocol) + (href.protocol || href.authority ? href.authority : base.authority) + removeDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : href.pathname ? (base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname : base.pathname) + (href.protocol || href.authority || href.pathname ? href.search : href.search || base.search) + href.hash;\n  }\n\n  function getDocumentUri(uri) {\n    return uri.split('#')[0];\n  }\n\n  function normSchema(schema, baseUri) {\n    if (schema && typeof schema === \"object\") {\n      if (baseUri === undefined) {\n        baseUri = schema.id;\n      } else if (typeof schema.id === \"string\") {\n        baseUri = resolveUrl(baseUri, schema.id);\n        schema.id = baseUri;\n      }\n\n      if (Array.isArray(schema)) {\n        for (var i = 0; i < schema.length; i++) {\n          normSchema(schema[i], baseUri);\n        }\n      } else {\n        if (typeof schema['$ref'] === \"string\") {\n          schema['$ref'] = resolveUrl(baseUri, schema['$ref']);\n        }\n\n        for (var key in schema) {\n          if (key !== \"enum\") {\n            normSchema(schema[key], baseUri);\n          }\n        }\n      }\n    }\n  }\n\n  function defaultErrorReporter(language) {\n    language = language || 'en';\n    var errorMessages = languages[language];\n    return function (error) {\n      var messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\n\n      if (typeof messageTemplate !== 'string') {\n        return \"Unknown error code \" + error.code + \": \" + JSON.stringify(error.messageParams);\n      }\n\n      var messageParams = error.params; // Adapted from Crockford's supplant()\n\n      return messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\n        var subValue = messageParams[varName];\n        return typeof subValue === 'string' || typeof subValue === 'number' ? subValue : whole;\n      });\n    };\n  }\n\n  var ErrorCodes = {\n    INVALID_TYPE: 0,\n    ENUM_MISMATCH: 1,\n    ANY_OF_MISSING: 10,\n    ONE_OF_MISSING: 11,\n    ONE_OF_MULTIPLE: 12,\n    NOT_PASSED: 13,\n    // Numeric errors\n    NUMBER_MULTIPLE_OF: 100,\n    NUMBER_MINIMUM: 101,\n    NUMBER_MINIMUM_EXCLUSIVE: 102,\n    NUMBER_MAXIMUM: 103,\n    NUMBER_MAXIMUM_EXCLUSIVE: 104,\n    NUMBER_NOT_A_NUMBER: 105,\n    // String errors\n    STRING_LENGTH_SHORT: 200,\n    STRING_LENGTH_LONG: 201,\n    STRING_PATTERN: 202,\n    // Object errors\n    OBJECT_PROPERTIES_MINIMUM: 300,\n    OBJECT_PROPERTIES_MAXIMUM: 301,\n    OBJECT_REQUIRED: 302,\n    OBJECT_ADDITIONAL_PROPERTIES: 303,\n    OBJECT_DEPENDENCY_KEY: 304,\n    // Array errors\n    ARRAY_LENGTH_SHORT: 400,\n    ARRAY_LENGTH_LONG: 401,\n    ARRAY_UNIQUE: 402,\n    ARRAY_ADDITIONAL_ITEMS: 403,\n    // Custom/user-defined errors\n    FORMAT_CUSTOM: 500,\n    KEYWORD_CUSTOM: 501,\n    // Schema structure\n    CIRCULAR_REFERENCE: 600,\n    // Non-standard validation options\n    UNKNOWN_PROPERTY: 1000\n  };\n  var ErrorCodeLookup = {};\n\n  for (var key in ErrorCodes) {\n    ErrorCodeLookup[ErrorCodes[key]] = key;\n  }\n\n  var ErrorMessagesDefault = {\n    INVALID_TYPE: \"Invalid type: {type} (expected {expected})\",\n    ENUM_MISMATCH: \"No enum match for: {value}\",\n    ANY_OF_MISSING: \"Data does not match any schemas from \\\"anyOf\\\"\",\n    ONE_OF_MISSING: \"Data does not match any schemas from \\\"oneOf\\\"\",\n    ONE_OF_MULTIPLE: \"Data is valid against more than one schema from \\\"oneOf\\\": indices {index1} and {index2}\",\n    NOT_PASSED: \"Data matches schema from \\\"not\\\"\",\n    // Numeric errors\n    NUMBER_MULTIPLE_OF: \"Value {value} is not a multiple of {multipleOf}\",\n    NUMBER_MINIMUM: \"Value {value} is less than minimum {minimum}\",\n    NUMBER_MINIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive minimum {minimum}\",\n    NUMBER_MAXIMUM: \"Value {value} is greater than maximum {maximum}\",\n    NUMBER_MAXIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive maximum {maximum}\",\n    NUMBER_NOT_A_NUMBER: \"Value {value} is not a valid number\",\n    // String errors\n    STRING_LENGTH_SHORT: \"String is too short ({length} chars), minimum {minimum}\",\n    STRING_LENGTH_LONG: \"String is too long ({length} chars), maximum {maximum}\",\n    STRING_PATTERN: \"String does not match pattern: {pattern}\",\n    // Object errors\n    OBJECT_PROPERTIES_MINIMUM: \"Too few properties defined ({propertyCount}), minimum {minimum}\",\n    OBJECT_PROPERTIES_MAXIMUM: \"Too many properties defined ({propertyCount}), maximum {maximum}\",\n    OBJECT_REQUIRED: \"Missing required property: {key}\",\n    OBJECT_ADDITIONAL_PROPERTIES: \"Additional properties not allowed\",\n    OBJECT_DEPENDENCY_KEY: \"Dependency failed - key must exist: {missing} (due to key: {key})\",\n    // Array errors\n    ARRAY_LENGTH_SHORT: \"Array is too short ({length}), minimum {minimum}\",\n    ARRAY_LENGTH_LONG: \"Array is too long ({length}), maximum {maximum}\",\n    ARRAY_UNIQUE: \"Array items are not unique (indices {match1} and {match2})\",\n    ARRAY_ADDITIONAL_ITEMS: \"Additional items not allowed\",\n    // Format errors\n    FORMAT_CUSTOM: \"Format validation failed ({message})\",\n    KEYWORD_CUSTOM: \"Keyword failed: {key} ({message})\",\n    // Schema structure\n    CIRCULAR_REFERENCE: \"Circular $refs: {urls}\",\n    // Non-standard validation options\n    UNKNOWN_PROPERTY: \"Unknown property (not in schema)\"\n  };\n\n  function ValidationError(code, params, dataPath, schemaPath, subErrors) {\n    Error.call(this);\n\n    if (code === undefined) {\n      throw new Error(\"No error code supplied: \" + schemaPath);\n    }\n\n    this.message = '';\n    this.params = params;\n    this.code = code;\n    this.dataPath = dataPath || \"\";\n    this.schemaPath = schemaPath || \"\";\n    this.subErrors = subErrors || null;\n    var err = new Error(this.message);\n    this.stack = err.stack || err.stacktrace;\n\n    if (!this.stack) {\n      try {\n        throw err;\n      } catch (err) {\n        this.stack = err.stack || err.stacktrace;\n      }\n    }\n  }\n\n  ValidationError.prototype = Object.create(Error.prototype);\n  ValidationError.prototype.constructor = ValidationError;\n  ValidationError.prototype.name = 'ValidationError';\n\n  ValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\n    if (dataPrefix !== null) {\n      dataPrefix = dataPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\n      this.dataPath = \"/\" + dataPrefix + this.dataPath;\n    }\n\n    if (schemaPrefix !== null) {\n      schemaPrefix = schemaPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\n      this.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\n    }\n\n    if (this.subErrors !== null) {\n      for (var i = 0; i < this.subErrors.length; i++) {\n        this.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\n      }\n    }\n\n    return this;\n  };\n\n  function isTrustedUrl(baseUrl, testUrl) {\n    if (testUrl.substring(0, baseUrl.length) === baseUrl) {\n      var remainder = testUrl.substring(baseUrl.length);\n\n      if (testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === \"/\" || remainder.charAt(0) === \"#\" || remainder.charAt(0) === \"?\") {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  var languages = {};\n\n  function createApi(language) {\n    var globalContext = new ValidatorContext();\n    var currentLanguage;\n    var customErrorReporter;\n    var api = {\n      setErrorReporter: function (reporter) {\n        if (typeof reporter === 'string') {\n          return this.language(reporter);\n        }\n\n        customErrorReporter = reporter;\n        return true;\n      },\n      addFormat: function () {\n        globalContext.addFormat.apply(globalContext, arguments);\n      },\n      language: function (code) {\n        if (!code) {\n          return currentLanguage;\n        }\n\n        if (!languages[code]) {\n          code = code.split('-')[0]; // fall back to base language\n        }\n\n        if (languages[code]) {\n          currentLanguage = code;\n          return code; // so you can tell if fall-back has happened\n        }\n\n        return false;\n      },\n      addLanguage: function (code, messageMap) {\n        var key;\n\n        for (key in ErrorCodes) {\n          if (messageMap[key] && !messageMap[ErrorCodes[key]]) {\n            messageMap[ErrorCodes[key]] = messageMap[key];\n          }\n        }\n\n        var rootCode = code.split('-')[0];\n\n        if (!languages[rootCode]) {\n          // use for base language if not yet defined\n          languages[code] = messageMap;\n          languages[rootCode] = messageMap;\n        } else {\n          languages[code] = Object.create(languages[rootCode]);\n\n          for (key in messageMap) {\n            if (typeof languages[rootCode][key] === 'undefined') {\n              languages[rootCode][key] = messageMap[key];\n            }\n\n            languages[code][key] = messageMap[key];\n          }\n        }\n\n        return this;\n      },\n      freshApi: function (language) {\n        var result = createApi();\n\n        if (language) {\n          result.language(language);\n        }\n\n        return result;\n      },\n      validate: function (data, schema, checkRecursive, banUnknownProperties) {\n        var def = defaultErrorReporter(currentLanguage);\n        var errorReporter = customErrorReporter ? function (error, data, schema) {\n          return customErrorReporter(error, data, schema) || def(error, data, schema);\n        } : def;\n        var context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\n\n        if (typeof schema === \"string\") {\n          schema = {\n            \"$ref\": schema\n          };\n        }\n\n        context.addSchema(\"\", schema);\n        var error = context.validateAll(data, schema, null, null, \"\");\n\n        if (!error && banUnknownProperties) {\n          error = context.banUnknownProperties(data, schema);\n        }\n\n        this.error = error;\n        this.missing = context.missing;\n        this.valid = error === null;\n        return this.valid;\n      },\n      validateResult: function () {\n        var result = {\n          toString: function () {\n            return this.valid ? 'valid' : this.error.message;\n          }\n        };\n        this.validate.apply(result, arguments);\n        return result;\n      },\n      validateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\n        var def = defaultErrorReporter(currentLanguage);\n        var errorReporter = customErrorReporter ? function (error, data, schema) {\n          return customErrorReporter(error, data, schema) || def(error, data, schema);\n        } : def;\n        var context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\n\n        if (typeof schema === \"string\") {\n          schema = {\n            \"$ref\": schema\n          };\n        }\n\n        context.addSchema(\"\", schema);\n        context.validateAll(data, schema, null, null, \"\");\n\n        if (banUnknownProperties) {\n          context.banUnknownProperties(data, schema);\n        }\n\n        var result = {\n          toString: function () {\n            return this.valid ? 'valid' : this.error.message;\n          }\n        };\n        result.errors = context.errors;\n        result.missing = context.missing;\n        result.valid = result.errors.length === 0;\n        return result;\n      },\n      addSchema: function () {\n        return globalContext.addSchema.apply(globalContext, arguments);\n      },\n      getSchema: function () {\n        return globalContext.getSchema.apply(globalContext, arguments);\n      },\n      getSchemaMap: function () {\n        return globalContext.getSchemaMap.apply(globalContext, arguments);\n      },\n      getSchemaUris: function () {\n        return globalContext.getSchemaUris.apply(globalContext, arguments);\n      },\n      getMissingUris: function () {\n        return globalContext.getMissingUris.apply(globalContext, arguments);\n      },\n      dropSchemas: function () {\n        globalContext.dropSchemas.apply(globalContext, arguments);\n      },\n      defineKeyword: function () {\n        globalContext.defineKeyword.apply(globalContext, arguments);\n      },\n      defineError: function (codeName, codeNumber, defaultMessage) {\n        if (typeof codeName !== 'string' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\n          throw new Error('Code name must be a string in UPPER_CASE_WITH_UNDERSCORES');\n        }\n\n        if (typeof codeNumber !== 'number' || codeNumber % 1 !== 0 || codeNumber < 10000) {\n          throw new Error('Code number must be an integer > 10000');\n        }\n\n        if (typeof ErrorCodes[codeName] !== 'undefined') {\n          throw new Error('Error already defined: ' + codeName + ' as ' + ErrorCodes[codeName]);\n        }\n\n        if (typeof ErrorCodeLookup[codeNumber] !== 'undefined') {\n          throw new Error('Error code already used: ' + ErrorCodeLookup[codeNumber] + ' as ' + codeNumber);\n        }\n\n        ErrorCodes[codeName] = codeNumber;\n        ErrorCodeLookup[codeNumber] = codeName;\n        ErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\n\n        for (var langCode in languages) {\n          var language = languages[langCode];\n\n          if (language[codeName]) {\n            language[codeNumber] = language[codeNumber] || language[codeName];\n          }\n        }\n      },\n      reset: function () {\n        globalContext.reset();\n        this.error = null;\n        this.missing = [];\n        this.valid = true;\n      },\n      missing: [],\n      error: null,\n      valid: true,\n      normSchema: normSchema,\n      resolveUrl: resolveUrl,\n      getDocumentUri: getDocumentUri,\n      errorCodes: ErrorCodes\n    };\n    api.language(language || 'en');\n    return api;\n  }\n\n  var tv4 = createApi();\n  tv4.addLanguage('en-gb', ErrorMessagesDefault); //legacy property\n\n  tv4.tv4 = tv4;\n  return tv4; // used by _header.js to globalise.\n});","map":{"version":3,"names":["global","factory","define","amd","module","exports","tv4","Object","keys","hasOwnProperty","prototype","hasDontEnumBug","toString","propertyIsEnumerable","dontEnums","dontEnumsLength","length","obj","TypeError","result","prop","call","push","i","create","F","o","arguments","Error","Array","isArray","vArg","indexOf","searchElement","t","len","n","Number","Infinity","Math","floor","abs","k","max","isFrozen","key","random","e","uriTemplateGlobalModifiers","uriTemplateSuffices","notReallyPercentEncode","string","encodeURI","replace","doubleEncoded","substring","uriTemplateSubstitution","spec","modifier","charAt","separator","prefix","shouldEscape","showVariables","trimEmptyString","varNames","varList","split","varSpecs","varSpecMap","varName","truncate","parts","parseInt","suffices","varSpec","name","subFunction","valueFunction","startIndex","value","undefined","j","encodeURIComponent","first","substitution","UriTemplate","template","textParts","shift","prefixes","substitutions","part","remainder","funcs","concat","fill","fillFromObject","ValidatorContext","parent","collectMultiple","errorReporter","checkRecursive","trackUnknownProperties","missing","missingMap","formatValidators","schemas","errors","handleError","collectError","returnError","scanned","scannedFrozen","scannedFrozenSchemas","scannedFrozenValidationErrors","validatedSchemasKey","validationErrorsKey","knownPropertyPaths","unknownPropertyPaths","defaultErrorReporter","definedKeywords","slice","defineKeyword","keyword","keywordFunction","createError","code","messageParams","dataPath","schemaPath","subErrors","data","schema","error","ValidationError","message","prefixErrors","prefixWith","banUnknownProperties","unknownPath","ErrorCodes","UNKNOWN_PROPERTY","path","addFormat","format","validator","resolveRefs","urlHistory","CIRCULAR_REFERENCE","urls","join","getSchema","url","baseUrl","fragment","pointerPath","decodeURIComponent","component","searchSchemas","id","isTrustedUrl","uri","getDocumentUri","addSchema","normSchema","getSchemaMap","map","getSchemaUris","filterRegExp","list","test","getMissingUris","dropSchemas","reset","validateAll","dataPathParts","schemaPathParts","dataPointerPath","topLevel","startErrorCount","frozenIndex","scannedFrozenSchemaIndex","scannedSchemasIndex","schemaIndex","frozenSchemaIndex","defineProperty","configurable","errorCount","validateBasic","validateNumeric","validateString","validateArray","validateObject","validateCombinations","validateHypermedia","validateFormat","validateDefinedKeywords","item","pop","dataPart","schemaPart","errorMessage","FORMAT_CUSTOM","validationFunctions","func","KEYWORD_CUSTOM","recursiveCompare","A","B","validateType","validateEnum","type","dataType","allowedTypes","INVALID_TYPE","expected","enumVal","ENUM_MISMATCH","JSON","stringify","validateMultipleOf","validateMinMax","validateNaN","CLOSE_ENOUGH_LOW","pow","CLOSE_ENOUGH_HIGH","multipleOf","divisibleBy","NUMBER_MULTIPLE_OF","minimum","NUMBER_MINIMUM","exclusiveMinimum","NUMBER_MINIMUM_EXCLUSIVE","maximum","NUMBER_MAXIMUM","exclusiveMaximum","NUMBER_MAXIMUM_EXCLUSIVE","isNaN","NUMBER_NOT_A_NUMBER","validateStringLength","validateStringPattern","minLength","STRING_LENGTH_SHORT","maxLength","STRING_LENGTH_LONG","pattern","RegExp","regexp","body","flags","literal","match","STRING_PATTERN","validateArrayLength","validateArrayUniqueItems","validateArrayItems","minItems","ARRAY_LENGTH_SHORT","maxItems","ARRAY_LENGTH_LONG","uniqueItems","ARRAY_UNIQUE","match1","match2","items","additionalItems","ARRAY_ADDITIONAL_ITEMS","validateObjectMinMaxProperties","validateObjectRequiredProperties","validateObjectProperties","validateObjectDependencies","minProperties","OBJECT_PROPERTIES_MINIMUM","propertyCount","maxProperties","OBJECT_PROPERTIES_MAXIMUM","required","OBJECT_REQUIRED","keyPointerPath","foundMatch","properties","patternProperties","patternKey","additionalProperties","OBJECT_ADDITIONAL_PROPERTIES","dependencies","depKey","dep","OBJECT_DEPENDENCY_KEY","requiredKey","validateAllOf","validateAnyOf","validateOneOf","validateNot","allOf","subSchema","anyOf","oldUnknownPropertyPaths","oldKnownPropertyPaths","errorAtEnd","knownKey","unknownKey","ANY_OF_MISSING","oneOf","validIndex","ONE_OF_MULTIPLE","index1","index2","ONE_OF_MISSING","not","oldErrorCount","notErrors","NOT_PASSED","links","ldo","rel","href","allPresent","schemaUrl","parseURI","m","String","protocol","authority","host","hostname","port","pathname","search","hash","resolveUrl","base","removeDotSegments","input","output","p","lastIndexOf","baseUri","language","errorMessages","languages","messageTemplate","ErrorMessagesDefault","params","whole","subValue","ErrorCodeLookup","err","stack","stacktrace","constructor","dataPrefix","schemaPrefix","testUrl","createApi","globalContext","currentLanguage","customErrorReporter","api","setErrorReporter","reporter","apply","addLanguage","messageMap","rootCode","freshApi","validate","def","context","valid","validateResult","validateMultiple","defineError","codeName","codeNumber","defaultMessage","langCode","errorCodes"],"sources":["/Users/eduardoferroni/Documents/Pessoal/projects/Advanced-React-Redux/testing/node_modules/tv4/tv4.js"],"sourcesContent":["/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\r\n(function (global, factory) {\r\n  if (typeof define === 'function' && define.amd) {\r\n    // AMD. Register as an anonymous module.\r\n    define([], factory);\r\n  } else if (typeof module !== 'undefined' && module.exports){\r\n    // CommonJS. Define export.\r\n    module.exports = factory();\r\n  } else {\r\n    // Browser globals\r\n    global.tv4 = factory();\r\n  }\r\n}(this, function () {\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\r\nif (!Object.keys) {\r\n\tObject.keys = (function () {\r\n\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\r\n\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\r\n\t\t\tdontEnums = [\r\n\t\t\t\t'toString',\r\n\t\t\t\t'toLocaleString',\r\n\t\t\t\t'valueOf',\r\n\t\t\t\t'hasOwnProperty',\r\n\t\t\t\t'isPrototypeOf',\r\n\t\t\t\t'propertyIsEnumerable',\r\n\t\t\t\t'constructor'\r\n\t\t\t],\r\n\t\t\tdontEnumsLength = dontEnums.length;\r\n\r\n\t\treturn function (obj) {\r\n\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\r\n\t\t\t\tthrow new TypeError('Object.keys called on non-object');\r\n\t\t\t}\r\n\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\r\n\t\t\t\t\tresult.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDontEnumBug) {\r\n\t\t\t\tfor (var i=0; i < dontEnumsLength; i++) {\r\n\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\r\n\t\t\t\t\t\tresult.push(dontEnums[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\r\nif (!Object.create) {\r\n\tObject.create = (function(){\r\n\t\tfunction F(){}\r\n\r\n\t\treturn function(o){\r\n\t\t\tif (arguments.length !== 1) {\r\n\t\t\t\tthrow new Error('Object.create implementation only accepts one parameter.');\r\n\t\t\t}\r\n\t\t\tF.prototype = o;\r\n\t\t\treturn new F();\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\r\nif(!Array.isArray) {\r\n\tArray.isArray = function (vArg) {\r\n\t\treturn Object.prototype.toString.call(vArg) === \"[object Array]\";\r\n\t};\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\r\nif (!Array.prototype.indexOf) {\r\n\tArray.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\r\n\t\tif (this === null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tvar t = Object(this);\r\n\t\tvar len = t.length >>> 0;\r\n\r\n\t\tif (len === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar n = 0;\r\n\t\tif (arguments.length > 1) {\r\n\t\t\tn = Number(arguments[1]);\r\n\t\t\tif (n !== n) { // shortcut for verifying if it's NaN\r\n\t\t\t\tn = 0;\r\n\t\t\t} else if (n !== 0 && n !== Infinity && n !== -Infinity) {\r\n\t\t\t\tn = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (n >= len) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\r\n\t\tfor (; k < len; k++) {\r\n\t\t\tif (k in t && t[k] === searchElement) {\r\n\t\t\t\treturn k;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\n// Grungey Object.isFrozen hack\r\nif (!Object.isFrozen) {\r\n\tObject.isFrozen = function (obj) {\r\n\t\tvar key = \"tv4_test_frozen_key\";\r\n\t\twhile (obj.hasOwnProperty(key)) {\r\n\t\t\tkey += Math.random();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tobj[key] = true;\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn false;\r\n\t\t} catch (e) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n}\r\n// Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\r\n\r\nvar uriTemplateGlobalModifiers = {\r\n\t\"+\": true,\r\n\t\"#\": true,\r\n\t\".\": true,\r\n\t\"/\": true,\r\n\t\";\": true,\r\n\t\"?\": true,\r\n\t\"&\": true\r\n};\r\nvar uriTemplateSuffices = {\r\n\t\"*\": true\r\n};\r\n\r\nfunction notReallyPercentEncode(string) {\r\n\treturn encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\r\n\t\treturn \"%\" + doubleEncoded.substring(3);\r\n\t});\r\n}\r\n\r\nfunction uriTemplateSubstitution(spec) {\r\n\tvar modifier = \"\";\r\n\tif (uriTemplateGlobalModifiers[spec.charAt(0)]) {\r\n\t\tmodifier = spec.charAt(0);\r\n\t\tspec = spec.substring(1);\r\n\t}\r\n\tvar separator = \"\";\r\n\tvar prefix = \"\";\r\n\tvar shouldEscape = true;\r\n\tvar showVariables = false;\r\n\tvar trimEmptyString = false;\r\n\tif (modifier === '+') {\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === \".\") {\r\n\t\tprefix = \".\";\r\n\t\tseparator = \".\";\r\n\t} else if (modifier === \"/\") {\r\n\t\tprefix = \"/\";\r\n\t\tseparator = \"/\";\r\n\t} else if (modifier === '#') {\r\n\t\tprefix = \"#\";\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === ';') {\r\n\t\tprefix = \";\";\r\n\t\tseparator = \";\";\r\n\t\tshowVariables = true;\r\n\t\ttrimEmptyString = true;\r\n\t} else if (modifier === '?') {\r\n\t\tprefix = \"?\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t} else if (modifier === '&') {\r\n\t\tprefix = \"&\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t}\r\n\r\n\tvar varNames = [];\r\n\tvar varList = spec.split(\",\");\r\n\tvar varSpecs = [];\r\n\tvar varSpecMap = {};\r\n\tfor (var i = 0; i < varList.length; i++) {\r\n\t\tvar varName = varList[i];\r\n\t\tvar truncate = null;\r\n\t\tif (varName.indexOf(\":\") !== -1) {\r\n\t\t\tvar parts = varName.split(\":\");\r\n\t\t\tvarName = parts[0];\r\n\t\t\ttruncate = parseInt(parts[1], 10);\r\n\t\t}\r\n\t\tvar suffices = {};\r\n\t\twhile (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\r\n\t\t\tsuffices[varName.charAt(varName.length - 1)] = true;\r\n\t\t\tvarName = varName.substring(0, varName.length - 1);\r\n\t\t}\r\n\t\tvar varSpec = {\r\n\t\t\ttruncate: truncate,\r\n\t\t\tname: varName,\r\n\t\t\tsuffices: suffices\r\n\t\t};\r\n\t\tvarSpecs.push(varSpec);\r\n\t\tvarSpecMap[varName] = varSpec;\r\n\t\tvarNames.push(varName);\r\n\t}\r\n\tvar subFunction = function (valueFunction) {\r\n\t\tvar result = \"\";\r\n\t\tvar startIndex = 0;\r\n\t\tfor (var i = 0; i < varSpecs.length; i++) {\r\n\t\t\tvar varSpec = varSpecs[i];\r\n\t\t\tvar value = valueFunction(varSpec.name);\r\n\t\t\tif (value === null || value === undefined || (Array.isArray(value) && value.length === 0) || (typeof value === 'object' && Object.keys(value).length === 0)) {\r\n\t\t\t\tstartIndex++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (i === startIndex) {\r\n\t\t\t\tresult += prefix;\r\n\t\t\t} else {\r\n\t\t\t\tresult += (separator || \",\");\r\n\t\t\t}\r\n\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tfor (var j = 0; j < value.length; j++) {\r\n\t\t\t\t\tif (j > 0) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t\tif (varSpec.suffices['*'] && showVariables) {\r\n\t\t\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === \"object\") {\r\n\t\t\t\tif (showVariables && !varSpec.suffices['*']) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tvar first = true;\r\n\t\t\t\tfor (var key in value) {\r\n\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\r\n\t\t\t\t\tresult += varSpec.suffices['*'] ? '=' : \",\";\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name;\r\n\t\t\t\t\tif (!trimEmptyString || value !== \"\") {\r\n\t\t\t\t\t\tresult += \"=\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (varSpec.truncate != null) {\r\n\t\t\t\t\tvalue = value.substring(0, varSpec.truncate);\r\n\t\t\t\t}\r\n\t\t\t\tresult += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\"): notReallyPercentEncode(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tsubFunction.varNames = varNames;\r\n\treturn {\r\n\t\tprefix: prefix,\r\n\t\tsubstitution: subFunction\r\n\t};\r\n}\r\n\r\nfunction UriTemplate(template) {\r\n\tif (!(this instanceof UriTemplate)) {\r\n\t\treturn new UriTemplate(template);\r\n\t}\r\n\tvar parts = template.split(\"{\");\r\n\tvar textParts = [parts.shift()];\r\n\tvar prefixes = [];\r\n\tvar substitutions = [];\r\n\tvar varNames = [];\r\n\twhile (parts.length > 0) {\r\n\t\tvar part = parts.shift();\r\n\t\tvar spec = part.split(\"}\")[0];\r\n\t\tvar remainder = part.substring(spec.length + 1);\r\n\t\tvar funcs = uriTemplateSubstitution(spec);\r\n\t\tsubstitutions.push(funcs.substitution);\r\n\t\tprefixes.push(funcs.prefix);\r\n\t\ttextParts.push(remainder);\r\n\t\tvarNames = varNames.concat(funcs.substitution.varNames);\r\n\t}\r\n\tthis.fill = function (valueFunction) {\r\n\t\tvar result = textParts[0];\r\n\t\tfor (var i = 0; i < substitutions.length; i++) {\r\n\t\t\tvar substitution = substitutions[i];\r\n\t\t\tresult += substitution(valueFunction);\r\n\t\t\tresult += textParts[i + 1];\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tthis.varNames = varNames;\r\n\tthis.template = template;\r\n}\r\nUriTemplate.prototype = {\r\n\ttoString: function () {\r\n\t\treturn this.template;\r\n\t},\r\n\tfillFromObject: function (obj) {\r\n\t\treturn this.fill(function (varName) {\r\n\t\t\treturn obj[varName];\r\n\t\t});\r\n\t}\r\n};\r\nvar ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.formatValidators = parent ? Object.create(parent.formatValidators) : {};\r\n\tthis.schemas = parent ? Object.create(parent.schemas) : {};\r\n\tthis.collectMultiple = collectMultiple;\r\n\tthis.errors = [];\r\n\tthis.handleError = collectMultiple ? this.collectError : this.returnError;\r\n\tif (checkRecursive) {\r\n\t\tthis.checkRecursive = true;\r\n\t\tthis.scanned = [];\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t\tthis.scannedFrozenValidationErrors = [];\r\n\t\tthis.validatedSchemasKey = 'tv4_validation_id';\r\n\t\tthis.validationErrorsKey = 'tv4_validation_errors_id';\r\n\t}\r\n\tif (trackUnknownProperties) {\r\n\t\tthis.trackUnknownProperties = true;\r\n\t\tthis.knownPropertyPaths = {};\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t}\r\n\tthis.errorReporter = errorReporter || defaultErrorReporter('en');\r\n\tif (typeof this.errorReporter === 'string') {\r\n\t\tthrow new Error('debug');\r\n\t}\r\n\tthis.definedKeywords = {};\r\n\tif (parent) {\r\n\t\tfor (var key in parent.definedKeywords) {\r\n\t\t\tthis.definedKeywords[key] = parent.definedKeywords[key].slice(0);\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\r\n\tthis.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\r\n\tthis.definedKeywords[keyword].push(keywordFunction);\r\n};\r\nValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\r\n\tvar error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\r\n\terror.message = this.errorReporter(error, data, schema);\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.returnError = function (error) {\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.collectError = function (error) {\r\n\tif (error) {\r\n\t\tthis.errors.push(error);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\r\n\tfor (var i = startIndex; i < this.errors.length; i++) {\r\n\t\tthis.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\r\n\t}\r\n\treturn this;\r\n};\r\nValidatorContext.prototype.banUnknownProperties = function (data, schema) {\r\n\tfor (var unknownPath in this.unknownPropertyPaths) {\r\n\t\tvar error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {path: unknownPath}, unknownPath, \"\", null, data, schema);\r\n\t\tvar result = this.handleError(error);\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.addFormat = function (format, validator) {\r\n\tif (typeof format === 'object') {\r\n\t\tfor (var key in format) {\r\n\t\t\tthis.addFormat(key, format[key]);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tthis.formatValidators[format] = validator;\r\n};\r\nValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\r\n\tif (schema['$ref'] !== undefined) {\r\n\t\turlHistory = urlHistory || {};\r\n\t\tif (urlHistory[schema['$ref']]) {\r\n\t\t\treturn this.createError(ErrorCodes.CIRCULAR_REFERENCE, {urls: Object.keys(urlHistory).join(', ')}, '', '', null, undefined, schema);\r\n\t\t}\r\n\t\turlHistory[schema['$ref']] = true;\r\n\t\tschema = this.getSchema(schema['$ref'], urlHistory);\r\n\t}\r\n\treturn schema;\r\n};\r\nValidatorContext.prototype.getSchema = function (url, urlHistory) {\r\n\tvar schema;\r\n\tif (this.schemas[url] !== undefined) {\r\n\t\tschema = this.schemas[url];\r\n\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t}\r\n\tvar baseUrl = url;\r\n\tvar fragment = \"\";\r\n\tif (url.indexOf('#') !== -1) {\r\n\t\tfragment = url.substring(url.indexOf(\"#\") + 1);\r\n\t\tbaseUrl = url.substring(0, url.indexOf(\"#\"));\r\n\t}\r\n\tif (typeof this.schemas[baseUrl] === 'object') {\r\n\t\tschema = this.schemas[baseUrl];\r\n\t\tvar pointerPath = decodeURIComponent(fragment);\r\n\t\tif (pointerPath === \"\") {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t} else if (pointerPath.charAt(0) !== \"/\") {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar parts = pointerPath.split(\"/\").slice(1);\r\n\t\tfor (var i = 0; i < parts.length; i++) {\r\n\t\t\tvar component = parts[i].replace(/~1/g, \"/\").replace(/~0/g, \"~\");\r\n\t\t\tif (schema[component] === undefined) {\r\n\t\t\t\tschema = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tschema = schema[component];\r\n\t\t}\r\n\t\tif (schema !== undefined) {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t}\r\n\t}\r\n\tif (this.missing[baseUrl] === undefined) {\r\n\t\tthis.missing.push(baseUrl);\r\n\t\tthis.missing[baseUrl] = baseUrl;\r\n\t\tthis.missingMap[baseUrl] = baseUrl;\r\n\t}\r\n};\r\nValidatorContext.prototype.searchSchemas = function (schema, url) {\r\n\tif (Array.isArray(schema)) {\r\n\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\tthis.searchSchemas(schema[i], url);\r\n\t\t}\r\n\t} else if (schema && typeof schema === \"object\") {\r\n\t\tif (typeof schema.id === \"string\") {\r\n\t\t\tif (isTrustedUrl(url, schema.id)) {\r\n\t\t\t\tif (this.schemas[schema.id] === undefined) {\r\n\t\t\t\t\tthis.schemas[schema.id] = schema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var key in schema) {\r\n\t\t\tif (key !== \"enum\") {\r\n\t\t\t\tif (typeof schema[key] === \"object\") {\r\n\t\t\t\t\tthis.searchSchemas(schema[key], url);\r\n\t\t\t\t} else if (key === \"$ref\") {\r\n\t\t\t\t\tvar uri = getDocumentUri(schema[key]);\r\n\t\t\t\t\tif (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\r\n\t\t\t\t\t\tthis.missingMap[uri] = uri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.addSchema = function (url, schema) {\r\n\t//overload\r\n\tif (typeof url !== 'string' || typeof schema === 'undefined') {\r\n\t\tif (typeof url === 'object' && typeof url.id === 'string') {\r\n\t\t\tschema = url;\r\n\t\t\turl = schema.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif (url === getDocumentUri(url) + \"#\") {\r\n\t\t// Remove empty fragment\r\n\t\turl = getDocumentUri(url);\r\n\t}\r\n\tthis.schemas[url] = schema;\r\n\tdelete this.missingMap[url];\r\n\tnormSchema(schema, url);\r\n\tthis.searchSchemas(schema, url);\r\n};\r\n\r\nValidatorContext.prototype.getSchemaMap = function () {\r\n\tvar map = {};\r\n\tfor (var key in this.schemas) {\r\n\t\tmap[key] = this.schemas[key];\r\n\t}\r\n\treturn map;\r\n};\r\n\r\nValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.schemas) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.getMissingUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.missingMap) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.dropSchemas = function () {\r\n\tthis.schemas = {};\r\n\tthis.reset();\r\n};\r\nValidatorContext.prototype.reset = function () {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.errors = [];\r\n};\r\n\r\nValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\r\n\tvar topLevel;\r\n\tschema = this.resolveRefs(schema);\r\n\tif (!schema) {\r\n\t\treturn null;\r\n\t} else if (schema instanceof ValidationError) {\r\n\t\tthis.errors.push(schema);\r\n\t\treturn schema;\r\n\t}\r\n\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar frozenIndex, scannedFrozenSchemaIndex = null, scannedSchemasIndex = null;\r\n\tif (this.checkRecursive && data && typeof data === 'object') {\r\n\t\ttopLevel = !this.scanned.length;\r\n\t\tif (data[this.validatedSchemasKey]) {\r\n\t\t\tvar schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\r\n\t\t\tif (schemaIndex !== -1) {\r\n\t\t\t\tthis.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tfrozenIndex = this.scannedFrozen.indexOf(data);\r\n\t\t\tif (frozenIndex !== -1) {\r\n\t\t\t\tvar frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\r\n\t\t\t\tif (frozenSchemaIndex !== -1) {\r\n\t\t\t\t\tthis.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.scanned.push(data);\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tif (frozenIndex === -1) {\r\n\t\t\t\tfrozenIndex = this.scannedFrozen.length;\r\n\t\t\t\tthis.scannedFrozen.push(data);\r\n\t\t\t\tthis.scannedFrozenSchemas.push([]);\r\n\t\t\t}\r\n\t\t\tscannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\r\n\t\t\tthis.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\r\n\t\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\r\n\t\t} else {\r\n\t\t\tif (!data[this.validatedSchemasKey]) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tObject.defineProperty(data, this.validatedSchemasKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\tObject.defineProperty(data, this.validationErrorsKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t//IE 7/8 workaround\r\n\t\t\t\t\tdata[this.validatedSchemasKey] = [];\r\n\t\t\t\t\tdata[this.validationErrorsKey] = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tscannedSchemasIndex = data[this.validatedSchemasKey].length;\r\n\t\t\tdata[this.validatedSchemasKey][scannedSchemasIndex] = schema;\r\n\t\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = [];\r\n\t\t}\r\n\t}\r\n\r\n\tvar errorCount = this.errors.length;\r\n\tvar error = this.validateBasic(data, schema, dataPointerPath)\r\n\t\t|| this.validateNumeric(data, schema, dataPointerPath)\r\n\t\t|| this.validateString(data, schema, dataPointerPath)\r\n\t\t|| this.validateArray(data, schema, dataPointerPath)\r\n\t\t|| this.validateObject(data, schema, dataPointerPath)\r\n\t\t|| this.validateCombinations(data, schema, dataPointerPath)\r\n\t\t|| this.validateHypermedia(data, schema, dataPointerPath)\r\n\t\t|| this.validateFormat(data, schema, dataPointerPath)\r\n\t\t|| this.validateDefinedKeywords(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n\r\n\tif (topLevel) {\r\n\t\twhile (this.scanned.length) {\r\n\t\t\tvar item = this.scanned.pop();\r\n\t\t\tdelete item[this.validatedSchemasKey];\r\n\t\t}\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t}\r\n\r\n\tif (error || errorCount !== this.errors.length) {\r\n\t\twhile ((dataPathParts && dataPathParts.length) || (schemaPathParts && schemaPathParts.length)) {\r\n\t\t\tvar dataPart = (dataPathParts && dataPathParts.length) ? \"\" + dataPathParts.pop() : null;\r\n\t\t\tvar schemaPart = (schemaPathParts && schemaPathParts.length) ? \"\" + schemaPathParts.pop() : null;\r\n\t\t\tif (error) {\r\n\t\t\t\terror = error.prefixWith(dataPart, schemaPart);\r\n\t\t\t}\r\n\t\t\tthis.prefixErrors(errorCount, dataPart, schemaPart);\r\n\t\t}\r\n\t}\r\n\r\n\tif (scannedFrozenSchemaIndex !== null) {\r\n\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\r\n\t} else if (scannedSchemasIndex !== null) {\r\n\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\r\n\t}\r\n\r\n\treturn this.handleError(error);\r\n};\r\nValidatorContext.prototype.validateFormat = function (data, schema) {\r\n\tif (typeof schema.format !== 'string' || !this.formatValidators[schema.format]) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errorMessage = this.formatValidators[schema.format].call(null, data, schema);\r\n\tif (typeof errorMessage === 'string' || typeof errorMessage === 'number') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage}, '', '/format', null, data, schema);\r\n\t} else if (errorMessage && typeof errorMessage === 'object') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage.message || \"?\"}, errorMessage.dataPath || '', errorMessage.schemaPath || \"/format\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\r\n\tfor (var key in this.definedKeywords) {\r\n\t\tif (typeof schema[key] === 'undefined') {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvar validationFunctions = this.definedKeywords[key];\r\n\t\tfor (var i = 0; i < validationFunctions.length; i++) {\r\n\t\t\tvar func = validationFunctions[i];\r\n\t\t\tvar result = func(data, schema[key], schema, dataPointerPath);\r\n\t\t\tif (typeof result === 'string' || typeof result === 'number') {\r\n\t\t\t\treturn this.createError(ErrorCodes.KEYWORD_CUSTOM, {key: key, message: result}, '', '', null, data, schema).prefixWith(null, key);\r\n\t\t\t} else if (result && typeof result === 'object') {\r\n\t\t\t\tvar code = result.code;\r\n\t\t\t\tif (typeof code === 'string') {\r\n\t\t\t\t\tif (!ErrorCodes[code]) {\r\n\t\t\t\t\t\tthrow new Error('Undefined error code (use defineError): ' + code);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcode = ErrorCodes[code];\r\n\t\t\t\t} else if (typeof code !== 'number') {\r\n\t\t\t\t\tcode = ErrorCodes.KEYWORD_CUSTOM;\r\n\t\t\t\t}\r\n\t\t\t\tvar messageParams = (typeof result.message === 'object') ? result.message : {key: key, message: result.message || \"?\"};\r\n\t\t\t\tvar schemaPath = result.schemaPath || (\"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1'));\r\n\t\t\t\treturn this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nfunction recursiveCompare(A, B) {\r\n\tif (A === B) {\r\n\t\treturn true;\r\n\t}\r\n\tif (A && B && typeof A === \"object\" && typeof B === \"object\") {\r\n\t\tif (Array.isArray(A) !== Array.isArray(B)) {\r\n\t\t\treturn false;\r\n\t\t} else if (Array.isArray(A)) {\r\n\t\t\tif (A.length !== B.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < A.length; i++) {\r\n\t\t\t\tif (!recursiveCompare(A[i], B[i])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (B[key] === undefined && A[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in B) {\r\n\t\t\t\tif (A[key] === undefined && B[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (!recursiveCompare(A[key], B[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (error = this.validateType(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\tif (error = this.validateEnum(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateType = function validateType(data, schema) {\r\n\tif (schema.type === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar dataType = typeof data;\r\n\tif (data === null) {\r\n\t\tdataType = \"null\";\r\n\t} else if (Array.isArray(data)) {\r\n\t\tdataType = \"array\";\r\n\t}\r\n\tvar allowedTypes = schema.type;\r\n\tif (!Array.isArray(allowedTypes)) {\r\n\t\tallowedTypes = [allowedTypes];\r\n\t}\r\n\r\n\tfor (var i = 0; i < allowedTypes.length; i++) {\r\n\t\tvar type = allowedTypes[i];\r\n\t\tif (type === dataType || (type === \"integer\" && dataType === \"number\" && (data % 1 === 0))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.INVALID_TYPE, {type: dataType, expected: allowedTypes.join(\"/\")}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\r\n\tif (schema[\"enum\"] === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var i = 0; i < schema[\"enum\"].length; i++) {\r\n\t\tvar enumVal = schema[\"enum\"][i];\r\n\t\tif (recursiveCompare(data, enumVal)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.ENUM_MISMATCH, {value: (typeof JSON !== 'undefined') ? JSON.stringify(data) : data}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\r\n\treturn this.validateMultipleOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateMinMax(data, schema, dataPointerPath)\r\n\t\t|| this.validateNaN(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nvar CLOSE_ENOUGH_LOW = Math.pow(2, -51);\r\nvar CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\r\nValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\r\n\tvar multipleOf = schema.multipleOf || schema.divisibleBy;\r\n\tif (multipleOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tif (typeof data === \"number\") {\r\n\t\tvar remainder = (data/multipleOf)%1;\r\n\t\tif (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {value: data, multipleOf: multipleOf}, '', '', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minimum !== undefined) {\r\n\t\tif (data < schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM, {value: data, minimum: schema.minimum}, '', '/minimum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMinimum && data === schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {value: data, minimum: schema.minimum}, '', '/exclusiveMinimum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maximum !== undefined) {\r\n\t\tif (data > schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM, {value: data, maximum: schema.maximum}, '', '/maximum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMaximum && data === schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {value: data, maximum: schema.maximum}, '', '/exclusiveMaximum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (isNaN(data) === true || data === Infinity || data === -Infinity) {\r\n\t\treturn this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {value: data}, '', '/type', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\r\n\treturn this.validateStringLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateStringPattern(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\r\n\tif (typeof data !== \"string\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minLength !== undefined) {\r\n\t\tif (data.length < schema.minLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_SHORT, {length: data.length, minimum: schema.minLength}, '', '/minLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maxLength !== undefined) {\r\n\t\tif (data.length > schema.maxLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_LONG, {length: data.length, maximum: schema.maxLength}, '', '/maxLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\r\n\tif (typeof data !== \"string\" || (typeof schema.pattern !== \"string\" && !(schema.pattern instanceof RegExp))) {\r\n\t\treturn null;\r\n\t}\r\n\tvar regexp;\r\n\tif (schema.pattern instanceof RegExp) {\r\n\t  regexp = schema.pattern;\r\n\t}\r\n\telse {\r\n\t  var body, flags = '';\r\n\t  // Check for regular expression literals\r\n\t  // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\r\n\t  var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\r\n\t  if (literal) {\r\n\t    body = literal[1];\r\n\t    flags = literal[2];\r\n\t  }\r\n\t  else {\r\n\t    body = schema.pattern;\r\n\t  }\r\n\t  regexp = new RegExp(body, flags);\r\n\t}\r\n\tif (!regexp.test(data)) {\r\n\t\treturn this.createError(ErrorCodes.STRING_PATTERN, {pattern: schema.pattern}, '', '/pattern', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\r\n\tif (!Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateArrayLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayUniqueItems(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayItems(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\r\n\tvar error;\r\n\tif (schema.minItems !== undefined) {\r\n\t\tif (data.length < schema.minItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {length: data.length, minimum: schema.minItems}, '', '/minItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxItems !== undefined) {\r\n\t\tif (data.length > schema.maxItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {length: data.length, maximum: schema.maxItems}, '', '/maxItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\r\n\tif (schema.uniqueItems) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tfor (var j = i + 1; j < data.length; j++) {\r\n\t\t\t\tif (recursiveCompare(data[i], data[j])) {\r\n\t\t\t\t\tvar error = this.createError(ErrorCodes.ARRAY_UNIQUE, {match1: i, match2: j}, '', '/uniqueItems', null, data, schema);\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\r\n\tif (schema.items === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error, i;\r\n\tif (Array.isArray(schema.items)) {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (i < schema.items.length) {\r\n\t\t\t\tif (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t} else if (schema.additionalItems !== undefined) {\r\n\t\t\t\tif (typeof schema.additionalItems === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalItems) {\r\n\t\t\t\t\t\terror = (this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, '/' + i, '/additionalItems', null, data, schema));\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (error = this.validateAll(data[i], schema.items, [i], [\"items\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\r\n\tif (typeof data !== \"object\" || data === null || Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateObjectMinMaxProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectRequiredProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectDependencies(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\r\n\tvar keys = Object.keys(data);\r\n\tvar error;\r\n\tif (schema.minProperties !== undefined) {\r\n\t\tif (keys.length < schema.minProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {propertyCount: keys.length, minimum: schema.minProperties}, '', '/minProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxProperties !== undefined) {\r\n\t\tif (keys.length > schema.maxProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {propertyCount: keys.length, maximum: schema.maxProperties}, '', '/maxProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\r\n\tif (schema.required !== undefined) {\r\n\t\tfor (var i = 0; i < schema.required.length; i++) {\r\n\t\t\tvar key = schema.required[i];\r\n\t\t\tif (data[key] === undefined) {\r\n\t\t\t\tvar error = this.createError(ErrorCodes.OBJECT_REQUIRED, {key: key}, '', '/required/' + i, null, data, schema);\r\n\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tfor (var key in data) {\r\n\t\tvar keyPointerPath = dataPointerPath + \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\r\n\t\tvar foundMatch = false;\r\n\t\tif (schema.properties !== undefined && schema.properties[key] !== undefined) {\r\n\t\t\tfoundMatch = true;\r\n\t\t\tif (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key], keyPointerPath)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (schema.patternProperties !== undefined) {\r\n\t\t\tfor (var patternKey in schema.patternProperties) {\r\n\t\t\t\tvar regexp = new RegExp(patternKey);\r\n\t\t\t\tif (regexp.test(key)) {\r\n\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!foundMatch) {\r\n\t\t\tif (schema.additionalProperties !== undefined) {\r\n\t\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof schema.additionalProperties === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalProperties) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {key: key}, '', '/additionalProperties', null, data, schema).prefixWith(key, null);\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\r\n\t\t\t\tthis.unknownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t}\r\n\t\t} else if (this.trackUnknownProperties) {\r\n\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (schema.dependencies !== undefined) {\r\n\t\tfor (var depKey in schema.dependencies) {\r\n\t\t\tif (data[depKey] !== undefined) {\r\n\t\t\t\tvar dep = schema.dependencies[depKey];\r\n\t\t\t\tif (typeof dep === \"string\") {\r\n\t\t\t\t\tif (data[dep] === undefined) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: dep}, '', '', null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (Array.isArray(dep)) {\r\n\t\t\t\t\tfor (var i = 0; i < dep.length; i++) {\r\n\t\t\t\t\t\tvar requiredKey = dep[i];\r\n\t\t\t\t\t\tif (data[requiredKey] === undefined) {\r\n\t\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: requiredKey}, '', '/' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data, dep, [], [\"dependencies\", depKey], dataPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\r\n\treturn this.validateAllOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateAnyOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateOneOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateNot(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\r\n\tif (schema.allOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.allOf.length; i++) {\r\n\t\tvar subSchema = schema.allOf[i];\r\n\t\tif (error = this.validateAll(data, subSchema, [], [\"allOf\", i], dataPointerPath)) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\r\n\tif (schema.anyOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tvar errorAtEnd = true;\r\n\tfor (var i = 0; i < schema.anyOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.anyOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"anyOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// We need to continue looping so we catch all the property definitions, but we don't want to return an error\r\n\t\t\t\terrorAtEnd = false;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (error) {\r\n\t\t\terrors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (errorAtEnd) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ANY_OF_MISSING, {}, \"\", \"/anyOf\", errors, data, schema);\r\n\t}\r\n};\r\n\r\nValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\r\n\tif (schema.oneOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar validIndex = null;\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tfor (var i = 0; i < schema.oneOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.oneOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"oneOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tif (validIndex === null) {\r\n\t\t\t\tvalidIndex = i;\r\n\t\t\t} else {\r\n\t\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\t\treturn this.createError(ErrorCodes.ONE_OF_MULTIPLE, {index1: validIndex, index2: i}, \"\", \"/oneOf\", null, data, schema);\r\n\t\t\t}\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (error) {\r\n\t\t\terrors.push(error);\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (validIndex === null) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ONE_OF_MISSING, {}, \"\", \"/oneOf\", errors, data, schema);\r\n\t} else {\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\r\n\tif (schema.not === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar oldErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t\tthis.knownPropertyPaths = {};\r\n\t}\r\n\tvar error = this.validateAll(data, schema.not, null, null, dataPointerPath);\r\n\tvar notErrors = this.errors.slice(oldErrorCount);\r\n\tthis.errors = this.errors.slice(0, oldErrorCount);\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (error === null && notErrors.length === 0) {\r\n\t\treturn this.createError(ErrorCodes.NOT_PASSED, {}, \"\", \"/not\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\r\n\tif (!schema.links) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.links.length; i++) {\r\n\t\tvar ldo = schema.links[i];\r\n\t\tif (ldo.rel === \"describedby\") {\r\n\t\t\tvar template = new UriTemplate(ldo.href);\r\n\t\t\tvar allPresent = true;\r\n\t\t\tfor (var j = 0; j < template.varNames.length; j++) {\r\n\t\t\t\tif (!(template.varNames[j] in data)) {\r\n\t\t\t\t\tallPresent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (allPresent) {\r\n\t\t\t\tvar schemaUrl = template.fillFromObject(data);\r\n\t\t\t\tvar subSchema = {\"$ref\": schemaUrl};\r\n\t\t\t\tif (error = this.validateAll(data, subSchema, [], [\"links\", i], dataPointerPath)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// parseURI() and resolveUrl() are from https://gist.github.com/1088850\r\n//   -  released as public domain by author (\"Yaffle\") - see comments on gist\r\n\r\nfunction parseURI(url) {\r\n\tvar m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/);\r\n\t// authority = '//' + user + ':' + pass '@' + hostname + ':' port\r\n\treturn (m ? {\r\n\t\thref     : m[0] || '',\r\n\t\tprotocol : m[1] || '',\r\n\t\tauthority: m[2] || '',\r\n\t\thost     : m[3] || '',\r\n\t\thostname : m[4] || '',\r\n\t\tport     : m[5] || '',\r\n\t\tpathname : m[6] || '',\r\n\t\tsearch   : m[7] || '',\r\n\t\thash     : m[8] || ''\r\n\t} : null);\r\n}\r\n\r\nfunction resolveUrl(base, href) {// RFC 3986\r\n\r\n\tfunction removeDotSegments(input) {\r\n\t\tvar output = [];\r\n\t\tinput.replace(/^(\\.\\.?(\\/|$))+/, '')\r\n\t\t\t.replace(/\\/(\\.(\\/|$))+/g, '/')\r\n\t\t\t.replace(/\\/\\.\\.$/, '/../')\r\n\t\t\t.replace(/\\/?[^\\/]*/g, function (p) {\r\n\t\t\t\tif (p === '/..') {\r\n\t\t\t\t\toutput.pop();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput.push(p);\r\n\t\t\t\t}\r\n\t\t});\r\n\t\treturn output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\r\n\t}\r\n\r\n\thref = parseURI(href || '');\r\n\tbase = parseURI(base || '');\r\n\r\n\treturn !href || !base ? null : (href.protocol || base.protocol) +\r\n\t\t(href.protocol || href.authority ? href.authority : base.authority) +\r\n\t\tremoveDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : (href.pathname ? ((base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname) : base.pathname)) +\r\n\t\t(href.protocol || href.authority || href.pathname ? href.search : (href.search || base.search)) +\r\n\t\thref.hash;\r\n}\r\n\r\nfunction getDocumentUri(uri) {\r\n\treturn uri.split('#')[0];\r\n}\r\nfunction normSchema(schema, baseUri) {\r\n\tif (schema && typeof schema === \"object\") {\r\n\t\tif (baseUri === undefined) {\r\n\t\t\tbaseUri = schema.id;\r\n\t\t} else if (typeof schema.id === \"string\") {\r\n\t\t\tbaseUri = resolveUrl(baseUri, schema.id);\r\n\t\t\tschema.id = baseUri;\r\n\t\t}\r\n\t\tif (Array.isArray(schema)) {\r\n\t\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\t\tnormSchema(schema[i], baseUri);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (typeof schema['$ref'] === \"string\") {\r\n\t\t\t\tschema['$ref'] = resolveUrl(baseUri, schema['$ref']);\r\n\t\t\t}\r\n\t\t\tfor (var key in schema) {\r\n\t\t\t\tif (key !== \"enum\") {\r\n\t\t\t\t\tnormSchema(schema[key], baseUri);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defaultErrorReporter(language) {\r\n\tlanguage = language || 'en';\r\n\r\n\tvar errorMessages = languages[language];\r\n\r\n\treturn function (error) {\r\n\t\tvar messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\r\n\t\tif (typeof messageTemplate !== 'string') {\r\n\t\t\treturn \"Unknown error code \" + error.code + \": \" + JSON.stringify(error.messageParams);\r\n\t\t}\r\n\t\tvar messageParams = error.params;\r\n\t\t// Adapted from Crockford's supplant()\r\n\t\treturn messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\r\n\t\t\tvar subValue = messageParams[varName];\r\n\t\t\treturn typeof subValue === 'string' || typeof subValue === 'number' ? subValue : whole;\r\n\t\t});\r\n\t};\r\n}\r\n\r\nvar ErrorCodes = {\r\n\tINVALID_TYPE: 0,\r\n\tENUM_MISMATCH: 1,\r\n\tANY_OF_MISSING: 10,\r\n\tONE_OF_MISSING: 11,\r\n\tONE_OF_MULTIPLE: 12,\r\n\tNOT_PASSED: 13,\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: 100,\r\n\tNUMBER_MINIMUM: 101,\r\n\tNUMBER_MINIMUM_EXCLUSIVE: 102,\r\n\tNUMBER_MAXIMUM: 103,\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: 104,\r\n\tNUMBER_NOT_A_NUMBER: 105,\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: 200,\r\n\tSTRING_LENGTH_LONG: 201,\r\n\tSTRING_PATTERN: 202,\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: 300,\r\n\tOBJECT_PROPERTIES_MAXIMUM: 301,\r\n\tOBJECT_REQUIRED: 302,\r\n\tOBJECT_ADDITIONAL_PROPERTIES: 303,\r\n\tOBJECT_DEPENDENCY_KEY: 304,\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: 400,\r\n\tARRAY_LENGTH_LONG: 401,\r\n\tARRAY_UNIQUE: 402,\r\n\tARRAY_ADDITIONAL_ITEMS: 403,\r\n\t// Custom/user-defined errors\r\n\tFORMAT_CUSTOM: 500,\r\n\tKEYWORD_CUSTOM: 501,\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: 600,\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: 1000\r\n};\r\nvar ErrorCodeLookup = {};\r\nfor (var key in ErrorCodes) {\r\n\tErrorCodeLookup[ErrorCodes[key]] = key;\r\n}\r\nvar ErrorMessagesDefault = {\r\n\tINVALID_TYPE: \"Invalid type: {type} (expected {expected})\",\r\n\tENUM_MISMATCH: \"No enum match for: {value}\",\r\n\tANY_OF_MISSING: \"Data does not match any schemas from \\\"anyOf\\\"\",\r\n\tONE_OF_MISSING: \"Data does not match any schemas from \\\"oneOf\\\"\",\r\n\tONE_OF_MULTIPLE: \"Data is valid against more than one schema from \\\"oneOf\\\": indices {index1} and {index2}\",\r\n\tNOT_PASSED: \"Data matches schema from \\\"not\\\"\",\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: \"Value {value} is not a multiple of {multipleOf}\",\r\n\tNUMBER_MINIMUM: \"Value {value} is less than minimum {minimum}\",\r\n\tNUMBER_MINIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive minimum {minimum}\",\r\n\tNUMBER_MAXIMUM: \"Value {value} is greater than maximum {maximum}\",\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive maximum {maximum}\",\r\n\tNUMBER_NOT_A_NUMBER: \"Value {value} is not a valid number\",\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: \"String is too short ({length} chars), minimum {minimum}\",\r\n\tSTRING_LENGTH_LONG: \"String is too long ({length} chars), maximum {maximum}\",\r\n\tSTRING_PATTERN: \"String does not match pattern: {pattern}\",\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: \"Too few properties defined ({propertyCount}), minimum {minimum}\",\r\n\tOBJECT_PROPERTIES_MAXIMUM: \"Too many properties defined ({propertyCount}), maximum {maximum}\",\r\n\tOBJECT_REQUIRED: \"Missing required property: {key}\",\r\n\tOBJECT_ADDITIONAL_PROPERTIES: \"Additional properties not allowed\",\r\n\tOBJECT_DEPENDENCY_KEY: \"Dependency failed - key must exist: {missing} (due to key: {key})\",\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: \"Array is too short ({length}), minimum {minimum}\",\r\n\tARRAY_LENGTH_LONG: \"Array is too long ({length}), maximum {maximum}\",\r\n\tARRAY_UNIQUE: \"Array items are not unique (indices {match1} and {match2})\",\r\n\tARRAY_ADDITIONAL_ITEMS: \"Additional items not allowed\",\r\n\t// Format errors\r\n\tFORMAT_CUSTOM: \"Format validation failed ({message})\",\r\n\tKEYWORD_CUSTOM: \"Keyword failed: {key} ({message})\",\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: \"Circular $refs: {urls}\",\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: \"Unknown property (not in schema)\"\r\n};\r\n\r\nfunction ValidationError(code, params, dataPath, schemaPath, subErrors) {\r\n\tError.call(this);\r\n\tif (code === undefined) {\r\n\t\tthrow new Error (\"No error code supplied: \" + schemaPath);\r\n\t}\r\n\tthis.message = '';\r\n\tthis.params = params;\r\n\tthis.code = code;\r\n\tthis.dataPath = dataPath || \"\";\r\n\tthis.schemaPath = schemaPath || \"\";\r\n\tthis.subErrors = subErrors || null;\r\n\r\n\tvar err = new Error(this.message);\r\n\tthis.stack = err.stack || err.stacktrace;\r\n\tif (!this.stack) {\r\n\t\ttry {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tthis.stack = err.stack || err.stacktrace;\r\n\t\t}\r\n\t}\r\n}\r\nValidationError.prototype = Object.create(Error.prototype);\r\nValidationError.prototype.constructor = ValidationError;\r\nValidationError.prototype.name = 'ValidationError';\r\n\r\nValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\r\n\tif (dataPrefix !== null) {\r\n\t\tdataPrefix = dataPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.dataPath = \"/\" + dataPrefix + this.dataPath;\r\n\t}\r\n\tif (schemaPrefix !== null) {\r\n\t\tschemaPrefix = schemaPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\r\n\t}\r\n\tif (this.subErrors !== null) {\r\n\t\tfor (var i = 0; i < this.subErrors.length; i++) {\r\n\t\t\tthis.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nfunction isTrustedUrl(baseUrl, testUrl) {\r\n\tif(testUrl.substring(0, baseUrl.length) === baseUrl){\r\n\t\tvar remainder = testUrl.substring(baseUrl.length);\r\n\t\tif ((testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === \"/\")\r\n\t\t\t|| remainder.charAt(0) === \"#\"\r\n\t\t\t|| remainder.charAt(0) === \"?\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nvar languages = {};\r\nfunction createApi(language) {\r\n\tvar globalContext = new ValidatorContext();\r\n\tvar currentLanguage;\r\n\tvar customErrorReporter;\r\n\tvar api = {\r\n\t\tsetErrorReporter: function (reporter) {\r\n\t\t\tif (typeof reporter === 'string') {\r\n\t\t\t\treturn this.language(reporter);\r\n\t\t\t}\r\n\t\t\tcustomErrorReporter = reporter;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\taddFormat: function () {\r\n\t\t\tglobalContext.addFormat.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tlanguage: function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\treturn currentLanguage;\r\n\t\t\t}\r\n\t\t\tif (!languages[code]) {\r\n\t\t\t\tcode = code.split('-')[0]; // fall back to base language\r\n\t\t\t}\r\n\t\t\tif (languages[code]) {\r\n\t\t\t\tcurrentLanguage = code;\r\n\t\t\t\treturn code; // so you can tell if fall-back has happened\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\taddLanguage: function (code, messageMap) {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in ErrorCodes) {\r\n\t\t\t\tif (messageMap[key] && !messageMap[ErrorCodes[key]]) {\r\n\t\t\t\t\tmessageMap[ErrorCodes[key]] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar rootCode = code.split('-')[0];\r\n\t\t\tif (!languages[rootCode]) { // use for base language if not yet defined\r\n\t\t\t\tlanguages[code] = messageMap;\r\n\t\t\t\tlanguages[rootCode] = messageMap;\r\n\t\t\t} else {\r\n\t\t\t\tlanguages[code] = Object.create(languages[rootCode]);\r\n\t\t\t\tfor (key in messageMap) {\r\n\t\t\t\t\tif (typeof languages[rootCode][key] === 'undefined') {\r\n\t\t\t\t\t\tlanguages[rootCode][key] = messageMap[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlanguages[code][key] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfreshApi: function (language) {\r\n\t\t\tvar result = createApi();\r\n\t\t\tif (language) {\r\n\t\t\t\tresult.language(language);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidate: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tvar error = context.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (!error && banUnknownProperties) {\r\n\t\t\t\terror = context.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tthis.error = error;\r\n\t\t\tthis.missing = context.missing;\r\n\t\t\tthis.valid = (error === null);\r\n\t\t\treturn this.valid;\r\n\t\t},\r\n\t\tvalidateResult: function () {\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tthis.validate.apply(result, arguments);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tcontext.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (banUnknownProperties) {\r\n\t\t\t\tcontext.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tresult.errors = context.errors;\r\n\t\t\tresult.missing = context.missing;\r\n\t\t\tresult.valid = (result.errors.length === 0);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\taddSchema: function () {\r\n\t\t\treturn globalContext.addSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchema: function () {\r\n\t\t\treturn globalContext.getSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaMap: function () {\r\n\t\t\treturn globalContext.getSchemaMap.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaUris: function () {\r\n\t\t\treturn globalContext.getSchemaUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetMissingUris: function () {\r\n\t\t\treturn globalContext.getMissingUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdropSchemas: function () {\r\n\t\t\tglobalContext.dropSchemas.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineKeyword: function () {\r\n\t\t\tglobalContext.defineKeyword.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineError: function (codeName, codeNumber, defaultMessage) {\r\n\t\t\tif (typeof codeName !== 'string' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\r\n\t\t\t\tthrow new Error('Code name must be a string in UPPER_CASE_WITH_UNDERSCORES');\r\n\t\t\t}\r\n\t\t\tif (typeof codeNumber !== 'number' || codeNumber%1 !== 0 || codeNumber < 10000) {\r\n\t\t\t\tthrow new Error('Code number must be an integer > 10000');\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodes[codeName] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error already defined: ' + codeName + ' as ' + ErrorCodes[codeName]);\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodeLookup[codeNumber] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error code already used: ' + ErrorCodeLookup[codeNumber] + ' as ' + codeNumber);\r\n\t\t\t}\r\n\t\t\tErrorCodes[codeName] = codeNumber;\r\n\t\t\tErrorCodeLookup[codeNumber] = codeName;\r\n\t\t\tErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\r\n\t\t\tfor (var langCode in languages) {\r\n\t\t\t\tvar language = languages[langCode];\r\n\t\t\t\tif (language[codeName]) {\r\n\t\t\t\t\tlanguage[codeNumber] = language[codeNumber] || language[codeName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treset: function () {\r\n\t\t\tglobalContext.reset();\r\n\t\t\tthis.error = null;\r\n\t\t\tthis.missing = [];\r\n\t\t\tthis.valid = true;\r\n\t\t},\r\n\t\tmissing: [],\r\n\t\terror: null,\r\n\t\tvalid: true,\r\n\t\tnormSchema: normSchema,\r\n\t\tresolveUrl: resolveUrl,\r\n\t\tgetDocumentUri: getDocumentUri,\r\n\t\terrorCodes: ErrorCodes\r\n\t};\r\n\tapi.language(language || 'en');\r\n\treturn api;\r\n}\r\n\r\nvar tv4 = createApi();\r\ntv4.addLanguage('en-gb', ErrorMessagesDefault);\r\n\r\n//legacy property\r\ntv4.tv4 = tv4;\r\n\r\nreturn tv4; // used by _header.js to globalise.\r\n\r\n}));"],"mappings":"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"},"metadata":{},"sourceType":"script"}